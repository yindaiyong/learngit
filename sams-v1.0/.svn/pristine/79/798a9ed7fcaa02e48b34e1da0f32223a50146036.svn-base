<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sams.custom.mapper.CheckFileUploadMapper" >
  <resultMap id="BaseResultMap" type="com.sams.custom.model.CheckFileUpload" >
    <result column="CFU_ID" property="cfuId" jdbcType="DECIMAL" />
    <result column="CFU_CHANNEL_CODE" property="cfuChannelCode" jdbcType="VARCHAR" />
    <result column="CFU_FILE_NAME" property="cfuFileName" jdbcType="VARCHAR" />
    <result column="CFU_LINE_NUMBER" property="cfuLineNumber" jdbcType="VARCHAR" />
    <result column="CFU_TRANS_DATE" property="cfuTransDate" jdbcType="VARCHAR" />
    <result column="CFU_UPLOAD_FLAG" property="cfuUploadFlag" jdbcType="VARCHAR" />
    <result column="CFU_MSG" property="cfuMsg" jdbcType="VARCHAR" />
    <result column="CFU_CUSER" property="cfuCuser" jdbcType="VARCHAR" />
    <result column="CFU_CTIME" property="cfuCtime" jdbcType="TIMESTAMP" />
    <result column="CFU_SUCCESS_TIME" property="cfuSuccessTime" jdbcType="VARCHAR" />
  </resultMap>
  
   <sql id="Base_Column_List" >
    CFU_ID , 
    CFU_CHANNEL_CODE , 
    CFU_FILE_NAME , 
    CFU_LINE_NUMBER , 
    CFU_TRANS_DATE , 
    CFU_UPLOAD_FLAG, 
    CFU_MSG, 
    CFU_CUSER, 
    CFU_CTIME,
    CFU_SUCCESS_TIME
  </sql>
  
  
  <insert id="insert" parameterType="com.sams.custom.model.CheckFileUpload" >
    insert into D_CHECK_FILE_UPLOAD (CFU_ID, CFU_CHANNEL_CODE, CFU_FILE_NAME, 
      CFU_LINE_NUMBER, CFU_TRANS_DATE, CFU_UPLOAD_FLAG, 
      CFU_MSG, CFU_CUSER, CFU_CTIME,CFU_SUCCESS_TIME
      )
    values (#{cfuId,jdbcType=DECIMAL}, #{cfuChannelCode,jdbcType=VARCHAR}, #{cfuFileName,jdbcType=VARCHAR}, 
      #{cfuLineNumber,jdbcType=VARCHAR}, #{cfuTransDate,jdbcType=VARCHAR}, #{cfuUploadFlag,jdbcType=VARCHAR}, 
      #{cfuMsg,jdbcType=VARCHAR}, #{cfuCuser,jdbcType=VARCHAR}, #{cfuCtime,jdbcType=TIMESTAMP},#{cfuSuccessTime,jdbcType=VARCHAR}
      )
  </insert>
  
  <insert id="insertSelective" parameterType="com.sams.custom.model.CheckFileUpload" >
    insert into D_CHECK_FILE_UPLOAD
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="cfuId != null" >
        CFU_ID,
      </if>
      <if test="cfuChannelCode != null" >
        CFU_CHANNEL_CODE,
      </if>
      <if test="cfuFileName != null" >
        CFU_FILE_NAME,
      </if>
      <if test="cfuLineNumber != null" >
        CFU_LINE_NUMBER,
      </if>
      <if test="cfuTransDate != null" >
        CFU_TRANS_DATE,
      </if>
      <if test="cfuUploadFlag != null" >
        CFU_UPLOAD_FLAG,
      </if>
      <if test="cfuMsg != null" >
        CFU_MSG,
      </if>
      <if test="cfuCuser != null" >
        CFU_CUSER,
      </if>
      <if test="cfuCtime != null" >
        CFU_CTIME,
      </if>
       <if test="cfuSuccessTime != null" >
        CFU_SUCCESS_TIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="cfuId != null" >
        #{cfuId,jdbcType=DECIMAL},
      </if>
      <if test="cfuChannelCode != null" >
        #{cfuChannelCode,jdbcType=VARCHAR},
      </if>
      <if test="cfuFileName != null" >
        #{cfuFileName,jdbcType=VARCHAR},
      </if>
      <if test="cfuLineNumber != null" >
        #{cfuLineNumber,jdbcType=VARCHAR},
      </if>
      <if test="cfuTransDate != null" >
        #{cfuTransDate,jdbcType=VARCHAR},
      </if>
      <if test="cfuUploadFlag != null" >
        #{cfuUploadFlag,jdbcType=VARCHAR},
      </if>
      <if test="cfuMsg != null" >
        #{cfuMsg,jdbcType=VARCHAR},
      </if>
      <if test="cfuCuser != null" >
        #{cfuCuser,jdbcType=VARCHAR},
      </if>
      <if test="cfuCtime != null" >
        #{cfuCtime,jdbcType=TIMESTAMP},
      </if>
      <if test="cfuSuccessTime != null" >
        #{cfuSuccessTime,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  
  
  <select id="findCheckFileUploadCondition" parameterType="java.util.Map"  resultMap="BaseResultMap">
       SELECT
        <include refid="Base_Column_List"/>
        FROM D_CHECK_FILE_UPLOAD
        where 1=1
        <if test=" condition.CHANNELCODE != null and condition.CHANNELCODE != ''  ">
                and CFU_CHANNEL_CODE = #{condition.CHANNELCODE}
        </if>
        <if test=" condition.TRANSDATE != null and condition.TRANSDATE != ''  ">
                and CFU_TRANS_DATE = #{condition.TRANSDATE} 
        </if>
        <if test="pageInfo.sort != null and pageInfo.sort != ''">
            order by ${pageInfo.sort} ${pageInfo.order}
        </if>
    </select>
    
    <select id="selectTransDateMaxLineNumber" parameterType="String"  resultType="String">
		 select nvl(max(to_number(cfu_line_number)),0) lineNumber
		   from d_check_file_upload
		  where cfu_trans_date = #{TRADEDATE,jdbcType=VARCHAR}
		  and cfu_upload_flag='01'
		  group by cfu_trans_date 
    </select>
    
    <insert id="insertUploadSuccessData"  parameterType="java.util.List" >
    insert all
     <foreach collection="list" item="item" index="index">
      into D_CHECK_FILE_UPLOAD (
            CFU_CHANNEL_CODE, CFU_FILE_NAME, 
            CFU_LINE_NUMBER, CFU_TRANS_DATE, CFU_UPLOAD_FLAG, 
            CFU_MSG, CFU_CUSER, CFU_CTIME,CFU_SUCCESS_TIME
     )
    values (
            #{item.CHANNELCODE,jdbcType=VARCHAR}, #{item.FILENAME,jdbcType=VARCHAR}, 
            #{item.LINENUMBER,jdbcType=VARCHAR}, #{item.TRANSDATE,jdbcType=VARCHAR}, #{item.UPLOADFLAG,jdbcType=VARCHAR}, 
            #{item.MSG,jdbcType=VARCHAR}, #{item.CUSER,jdbcType=VARCHAR}, sysdate,#{item.SUCCESSTIME,jdbcType=VARCHAR}
      )
     </foreach>
      select 1 from dual
  </insert>
</mapper>