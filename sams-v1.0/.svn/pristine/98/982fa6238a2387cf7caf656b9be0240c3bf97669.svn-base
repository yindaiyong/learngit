<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sams.custom.mapper.ChannelProductRelationMapper" >
  <resultMap id="BaseResultMap" type="com.sams.custom.model.ChannelProductRelation" >
    <id column="CPR_ID" property="cprId" jdbcType="DECIMAL" />
    <result column="CPR_CHANNEL_CODE" property="cprChannelCode" jdbcType="VARCHAR" />
    <result column="CPR_FUND_CODE" property="cprFundCode" jdbcType="VARCHAR" />
    <result column="CPR_SECTION_NUMBER" property="cprSectionNumber" jdbcType="VARCHAR" />
    <result column="CPR_FUND_RATE" property="cprFundRate" jdbcType="DECIMAL" />
    <result column="CPR_START_MONEY" property="cprStartMoney" jdbcType="VARCHAR" />
    <result column="CPR_END_MONEY" property="cprEndMoney" jdbcType="VARCHAR" />
    <result column="CPR_CTIME" property="cprCtime" jdbcType="TIMESTAMP" />
    <result column="CPR_UTIME" property="cprUtime" jdbcType="TIMESTAMP" />
    <result column="CPR_CUSER" property="cprCuser" jdbcType="VARCHAR" />
    <result column="CPR_UUSER" property="cprUuser" jdbcType="VARCHAR" />
    <result column="CPR_CHECK_STATE" property="cprCheckState" jdbcType="VARCHAR" />
    <result column="CPR_ACTION" property="cprAction" jdbcType="VARCHAR" />
    <result column="CPR_VALID_FLAG" property="cprValidFlag" jdbcType="VARCHAR" />
    <result column="CPR_BATCH_NO" property="cprBatchNumber" jdbcType="VARCHAR" />
  </resultMap>
   <resultMap id="productRealMap1" type="com.sams.custom.model.result.ChannelProductResult" extends="BaseResultMap">
       <result column="CP_TA_PRODUCT_CODE" property="cpTaProductCode" jdbcType="VARCHAR"/>
       <result column="CP_TA_PRODUCT_NAME" property="cpTaProductName"  jdbcType="VARCHAR"/>
       <result column="CP_CHECK_STATE" property="cpCheckState"  jdbcType="VARCHAR"/>
       <result column="CP_ID"  property="cpId"   jdbcType="VARCHAR"/>
  </resultMap>
  <resultMap id="productRealMap" type="com.sams.custom.model.result.ChannelProductResult" extends="BaseResultMap">
       <result column="pi_channel_product_name" property="piChannelProductName"  jdbcType="VARCHAR"/>
       <result column="PI_CHECK_STATE" property="piCheckState"  jdbcType="VARCHAR"/>
       <result column="PI_ID"  property="piId"   jdbcType="VARCHAR"/>
  </resultMap>
  <sql id="Base_Column_List" >
    CPR_ID, CPR_CHANNEL_CODE, CPR_FUND_CODE, CPR_SECTION_NUMBER, CPR_FUND_RATE, CPR_START_MONEY, 
    CPR_END_MONEY, CPR_CTIME, CPR_UTIME, CPR_CUSER, CPR_UUSER,CPR_CHECK_STATE,CPR_TA_PRODUCT_CODE,
    CPR_TA_PRODUCT_NAME,CPR_ACTION,CPR_VALID_FLAG,CPR_BATCH_NO
  </sql>
  
  <sql id="Base_Column_List_Deal" >
    CPR_CHANNEL_CODE CHANNELCODE, CPR_FUND_CODE FUNDCODE, CPR_SECTION_NUMBER SECTIONNUMBER, CPR_FUND_RATE FUNDRATE, CPR_START_MONEY STARTMONEY, 
    CPR_END_MONEY ENDMONEY
  </sql>
  
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from P_CHANNEL_PRODUCT_RELATION
    where CPR_ID = #{cprId,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    delete from P_CHANNEL_PRODUCT_RELATION
    where CPR_ID = #{cprId,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.sams.custom.model.ChannelProductRelation" >
    insert into P_CHANNEL_PRODUCT_RELATION (CPR_ID, CPR_CHANNEL_CODE, CPR_FUND_CODE, 
      CPR_SECTION_NUMBER, CPR_FUND_RATE, CPR_START_MONEY, 
      CPR_END_MONEY, CPR_CTIME, CPR_UTIME, 
      CPR_CUSER, CPR_UUSER,CPR_CHECK_STATE,CPR_ACTION,CPR_VALID_FLAG,CPR_BATCH_NO)
    values (#{cprId,jdbcType=DECIMAL}, #{cprChannelCode,jdbcType=VARCHAR}, #{cprFundCode,jdbcType=VARCHAR}, 
      #{cprSectionNumber,jdbcType=VARCHAR}, #{cprFundRate,jdbcType=DECIMAL}, #{cprStartMoney,jdbcType=VARCHAR}, 
      #{cprEndMoney,jdbcType=VARCHAR}, #{cprCtime,jdbcType=TIMESTAMP}, #{cprUtime,jdbcType=TIMESTAMP}, 
      #{cprCuser,jdbcType=VARCHAR}, #{cprUuser,jdbcType=VARCHAR},#{cprCheckState,jdbcType=VARCHAR},
      #{cprAction,jdbcType=VARCHAR},#{cprValidFlag,jdbcType=VARCHAR},#{cprBatchNumber,jdbcType=VARCHAR})
  </insert>
  
  <insert id="insertSelective" parameterType="com.sams.custom.model.ChannelProductRelation" >
    insert into P_CHANNEL_PRODUCT_RELATION
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="cprId != null" >
        CPR_ID,
      </if>
      <if test="cprChannelCode != null" >
        CPR_CHANNEL_CODE,
      </if>
      <if test="cprFundCode != null" >
        CPR_FUND_CODE,
      </if>
      <if test="cprSectionNumber != null" >
        CPR_SECTION_NUMBER,
      </if>
      <if test="cprFundRate != null" >
        CPR_FUND_RATE,
      </if>
      <if test="cprStartMoney != null" >
        CPR_START_MONEY,
      </if>
      <if test="cprEndMoney != null" >
        CPR_END_MONEY,
      </if>
      <if test="cprCtime != null" >
        CPR_CTIME,
      </if>
      <if test="cprUtime != null" >
        CPR_UTIME,
      </if>
      <if test="cprCuser != null" >
        CPR_CUSER,
      </if>
      <if test="cprCheckState != null" >
        CPR_CHECK_STATE,
      </if>
      <if test="cprValidFlag != null" >
        CPR_VALID_FLAG,
      </if>
      <if test="cprBatchNumber != null" >
        CPR_BATCH_NO,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="cprId != null" >
        #{cprId,jdbcType=DECIMAL},
      </if>
      <if test="cprChannelCode != null" >
        #{cprChannelCode,jdbcType=VARCHAR},
      </if>
      <if test="cprFundCode != null" >
        #{cprFundCode,jdbcType=VARCHAR},
      </if>
      <if test="cprSectionNumber != null" >
        #{cprSectionNumber,jdbcType=VARCHAR},
      </if>
      <if test="cprFundRate != null" >
        #{cprFundRate,jdbcType=DECIMAL},
      </if>
      <if test="cprStartMoney != null" >
        #{cprStartMoney,jdbcType=VARCHAR},
      </if>
      <if test="cprEndMoney != null" >
        #{cprEndMoney,jdbcType=VARCHAR},
      </if>
      <if test="cprCtime != null" >
        #{cprCtime,jdbcType=TIMESTAMP},
      </if>
      <if test="cprUtime != null" >
        #{cprUtime,jdbcType=TIMESTAMP},
      </if>
      <if test="cprCuser != null" >
        #{cprCuser,jdbcType=VARCHAR},
      </if>
      <if test="cprUuser != null" >
        #{cprUuser,jdbcType=VARCHAR},
      </if>
      <if test="cprUuser != null" >
        #{cprUuser,jdbcType=VARCHAR},
      </if>
      <if test="cprCheckState != null" >
        #{cprCheckState,jdbcType=VARCHAR},
      </if>
      <if test="cprValidFlag != null" >
        #{cprValidFlag,jdbcType=VARCHAR},
      </if>
       <if test="cprBatchNumber != null" >
        #{cprBatchNumber,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sams.custom.model.ChannelProductRelation" >
    update P_CHANNEL_PRODUCT_RELATION
    <set >
      <if test="cprChannelCode != null" >
        CPR_CHANNEL_CODE = #{cprChannelCode,jdbcType=VARCHAR},
      </if>
      <if test="cprFundCode != null" >
        CPR_FUND_CODE = #{cprFundCode,jdbcType=VARCHAR},
      </if>
      <if test="cprSectionNumber != null" >
        CPR_SECTION_NUMBER = #{cprSectionNumber,jdbcType=VARCHAR},
      </if>
      <if test="cprFundRate != null" >
        CPR_FUND_RATE = #{cprFundRate,jdbcType=DECIMAL},
      </if>
      <if test="cprStartMoney != null" >
        CPR_START_MONEY = #{cprStartMoney,jdbcType=VARCHAR},
      </if>
      <if test="cprEndMoney != null" >
        CPR_END_MONEY = #{cprEndMoney,jdbcType=VARCHAR},
      </if>
      <if test="cprCtime != null" >
        CPR_CTIME = #{cprCtime,jdbcType=TIMESTAMP},
      </if>
      <if test="cprUtime != null" >
        CPR_UTIME = #{cprUtime,jdbcType=TIMESTAMP},
      </if>
      <if test="cprCuser != null" >
        CPR_CUSER = #{cprCuser,jdbcType=VARCHAR},
      </if>
      <if test="cprUuser != null" >
        CPR_UUSER = #{cprUuser,jdbcType=VARCHAR},
      </if>
      <if test="cprCheckState != null" >
        CPR_CHECK_STATE = #{cprCheckState,jdbcType=VARCHAR},
      </if>
      <if test="cprAction != null" >
        CPR_ACTION = #{cprAction,jdbcType=VARCHAR},
      </if>
      <if test="cprValidFlag != null" >
        CPR_VALID_FLAG = #{cprValidFlag,jdbcType=VARCHAR},
      </if>
      <if test="cprBatchNumber != null" >
        CPR_BATCH_NO = #{cprBatchNumber,jdbcType=VARCHAR},
      </if>
    </set>
    where CPR_ID = #{cprId,jdbcType=DECIMAL}
  </update>
  
  <update id="updateByPrimaryKey" parameterType="com.sams.custom.model.ChannelProductRelation" >
    update P_CHANNEL_PRODUCT_RELATION
      <set >
          <if test="cprChannelCode != null" >
              CPR_CHANNEL_CODE = #{cprChannelCode,jdbcType=VARCHAR},
          </if>
          <if test="cprFundCode != null" >
              CPR_FUND_CODE = #{cprFundCode,jdbcType=VARCHAR},
          </if>
          <if test="cprSectionNumber != null" >
              CPR_SECTION_NUMBER = #{cprSectionNumber,jdbcType=VARCHAR},
          </if>
          <if test="cprFundRate != null" >
              CPR_FUND_RATE = #{cprFundRate,jdbcType=DECIMAL},
          </if>
          <if test="cprStartMoney != null" >
              CPR_START_MONEY = #{cprStartMoney,jdbcType=VARCHAR},
          </if>
          <if test="cprEndMoney != null" >
              CPR_END_MONEY = #{cprEndMoney,jdbcType=VARCHAR},
          </if>
          <if test="cprCtime != null" >
              CPR_CTIME = #{cprCtime,jdbcType=TIMESTAMP},
          </if>
          <if test="cprUtime != null" >
              CPR_UTIME = #{cprUtime,jdbcType=TIMESTAMP},
          </if>
          <if test="cprCuser != null" >
              CPR_CUSER = #{cprCuser,jdbcType=VARCHAR},
          </if>
          <if test="cprUuser != null" >
              CPR_UUSER = #{cprUuser,jdbcType=VARCHAR},
          </if>
          <if test="cprCheckState != null" >
              CPR_CHECK_STATE = #{cprCheckState,jdbcType=VARCHAR},
          </if>
          <if test="cprAction != null" >
              CPR_ACTION = #{cprAction,jdbcType=VARCHAR},
          </if>
          <if test="cprValidFlag != null" >
              CPR_VALID_FLAG = #{cprValidFlag,jdbcType=VARCHAR},
          </if>
          <if test="cprBatchNumber != null" >
              CPR_BATCH_NO = #{cprBatchNumber,jdbcType=VARCHAR},
          </if>
      </set>
    where CPR_ID = #{cprId,jdbcType=DECIMAL}
  </update>
  
  <select id="selectYieldGrade" resultType="hashMap" parameterType="hashMap" >
    select 
    <include refid="Base_Column_List_Deal" />
    from P_CHANNEL_PRODUCT_RELATION
    where CPR_CHECK_STATE='01'
     and CPR_CHANNEL_CODE = #{CHANNELCODE,jdbcType=VARCHAR}
     and CPR_FUND_CODE = #{FUNDCODE,jdbcType=VARCHAR}
      and cpr_valid_flag = '01'
  </select>
  
   <select id="selectUsedReal" resultType="int" parameterType="hashMap">
    select
        count(1)
     from P_CHANNEL_PRODUCT_RELATION where
         CPR_CHANNEL_CODE = #{CHANNELCODE,jdbcType=VARCHAR}
     and CPR_FUND_CODE = #{FUNDCODE,jdbcType=VARCHAR}
     and CPR_SECTION_NUMBER = #{SECTIONNUMBER,jdbcType=VARCHAR} 
     and CPR_BATCH_NO = #{BATCHNUMBER,jdbcType=VARCHAR}
     and cpr_valid_flag = '01'
   </select>
  
  
    <select id="selectSectionNumberAndFundRate" resultType="hashMap" parameterType="hashMap" >
    select 
    CPR_SECTION_NUMBER  SECTIONNUMBER,CPR_FUND_RATE  FUNDRATE
    from P_CHANNEL_PRODUCT_RELATION
    where CPR_CHECK_STATE='01'
     and CPR_VALID_FLAG='01'
     and CPR_CHANNEL_CODE = #{CHANNELCODE,jdbcType=VARCHAR}
     and CPR_FUND_CODE = #{FUNDCODE,jdbcType=VARCHAR}
      and #{APPLICATIONAMOUNT,jdbcType=VARCHAR} BETWEEN  to_number(cpr_start_money) and   to_number(cpr_end_money)
      and cpr_valid_flag='01' 
      and cpr_check_state='01'
     
  </select>
  
   <select id="selectProductInfo" resultType="hashMap" parameterType="hashMap">
	  select i.pi_product_type producttype,
	         i.pi_channel_product_code channelproductcode,
	         i.pi_channel_product_name channelproductname,
	         i.pi_indi_min_bids_amt indiminbidsamt,
	         i.pi_inst_min_bids_amt instminbidsamt,
	         i.pi_indi_bids_diff_amt indibidsdiffamt,
	         i.pi_inst_bids_diff_amt piinstbidsdiffamt,
	         i.pi_indi_max_bids_amt indimaxbidsamt,
	         i.pi_inst_max_bids_amt instmaxbidsamt,
	         i.pi_indi_min_app_bids_amt indiminappbidsamt,
	         i.pi_inst_min_app_bids_amt instminappbidsamt,
	         i.pi_indi_app_bids_diff_amt indiappbidsdiffamt,
	         i.pi_inst_app_bids_diff_amt instappbidsdiffamt,
	         i.pi_indi_max_app_bids_amt indimaxappbidsamt,
	         i.pi_inst_max_app_bids_amt instmaxappbidsamt,
	         i.pi_indi_min_redeem_vol indiminredeemvol,
	         i.pi_inst_min_redeem_vol instminredeemvol,
	         i.pi_indi_redeem_diff indiredeemdiff,
	         i.pi_inst_redeem_diff instredeemdiff,
	         i.pi_indi_max_vol indimaxvol,
	         i.pi_inst_max_vol instmaxvol,
	         i.pi_indi_min_vol indiminvol,
	         i.pi_inst_min_vol instminvol,
	         i.pi_channel_rate channel_rate,
	         i.pi_pay_type paytype,
	         i.pi_ipo_begin_date ipobegindate,
	         i.pi_ipo_end_date ipoenddate,
	         i.pi_pro_setup_date prosetupdate,
	         i.pi_pro_end_date proenddate,
	         i.pi_pro_yield_type proyieldtype,
	         i.pi_pro_yield proyield,
	         i.pi_fee_flag feeflag,
	         i.pi_indi_buy_flag indibuyflag,
	         i.pi_inst_buy_flag instbuyflag,
	         i.pi_pro_cfm_way procfmway,
	         i.pi_check_state checkstate,
	         i.pi_currency_type currencytype,
	         i.pi_annu_cal_days annucaldays,
	         i.pi_other_file_type otherfiletype,
	         i.pi_product_total_share producttotalshare,
	         i.pi_valid_flag validflag,
	         i.pi_accu_explain_buy_limit accuexplainbuylimit,
	         i.pi_min_indi_amount_raised minindiamountraised,
	         i.pi_max_indi_amount_raised maxindiamountraised,
	         i.pi_min_inst_amount_raised mininstamountraised,
	         i.pi_max_inst_amount_raised maxinstamountraised,
	         c.ci_market_code marketcode,
	         c.ci_channel_code channelcode,
	         p.cp_ta_product_code taproductcode,
	         c.ci_csdc_ver csdcver
	    from p_product_info i, p_channel_product p, p_channel_info c
	   where i.pi_channel_product_code = p.cp_channel_product_code
     	and p.cp_channel_code = c.ci_channel_code
	  	and c.ci_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
  </select>
  
  <select id="selectchannelProductCodeBytaProductCode" resultType="hashMap" parameterType="hashMap">
		select *
		  from P_CHANNEL_PRODUCT t
		 where t.cp_ta_product_code =#{FUNDCODE,jdbcType=VARCHAR}
		   and t.cp_channel_code =#{CHANNELCODE,jdbcType=VARCHAR}
  </select>
  
  <select id="findProductRealCondition1" parameterType="java.util.Map"  resultMap="productRealMap">
        select
        <include refid="Base_Column_List"/>
        ,b.CP_TA_PRODUCT_CODE,b.CP_TA_PRODUCT_NAME,b.CP_CHECK_STATE,b.CP_ID
        from p_channel_product_relation a, p_channel_product b
        where 1=1
        	    and a.cpr_channel_code=b.cp_channel_code and a.cpr_fund_code=b.cp_channel_product_code
        <if test=" condition.cprChannelCode != null and condition.cprChannelCode != ''  ">
                and a.CPR_CHANNEL_CODE like  ('%'|| #{condition.cprChannelCode} ||'%')
        </if>
        <if test=" condition.cprFundCode != null and condition.cprFundCode != ''  ">
                and a.CPR_FUND_CODE like  ('%'|| #{condition.cprFundCode} ||'%')
        </if>
        <if test=" condition.cpCheckState != null and condition.cpCheckState != '' ">
                and b.CP_CHECK_STATE = #{condition.cpCheckState} 
        </if>
        <if test="pageInfo.sort != null and pageInfo.sort != ''">
            order by ${pageInfo.sort} ${pageInfo.order}
        </if>
    </select>
    
    <select id="findProductRealCondition" parameterType="java.util.Map"  resultMap="productRealMap">
        select
        <include refid="Base_Column_List"/>
        ,b.pi_channel_product_name, b.pi_check_state,b.pi_id
        FROM p_channel_product_relation a, p_product_info b
        where (a.cpr_valid_flag!='00' or a.cpr_check_state!='01') 
        and a.cpr_channel_code=b.pi_channel_code 
        and a.cpr_fund_code = b.pi_channel_product_code
        and b.pi_valid_flag in('01','10','02')
        and b.pi_check_state='01'
        <if test=" condition.cprChannelCode != null and condition.cprChannelCode != ''  ">
                and a.CPR_CHANNEL_CODE = #{condition.cprChannelCode}
        </if>
        <if test=" condition.cprFundCode != null and condition.cprFundCode != ''  ">
                and a.CPR_FUND_CODE = #{condition.cprFundCode}
        </if>
        <if test=" condition.cprCheckState != null and condition.cprCheckState != '' ">
                and a.CPR_CHECK_STATE = #{condition.cprCheckState} 
        </if>
         <if test=" condition.cprBatchNumber != null and condition.cprBatchNumber != '' ">
                and a.CPR_BATCH_NO = #{condition.cprBatchNumber} 
        </if>
        
        <if test="pageInfo.sort != null and pageInfo.sort != ''">
            order by ${pageInfo.sort} ${pageInfo.order}
        </if>
    </select>
    
    
    
      <select id="selectProductRealResult" parameterType="java.util.Map"  resultMap="productRealMap">
         select
        <include refid="Base_Column_List"/>
        ,b.pi_channel_product_name, b.pi_check_state,b.pi_id
        FROM p_channel_product_relation a, p_product_info b
        where a.cpr_fund_code = b.pi_channel_product_code
        	     and a.CPR_ID = #{cprId,jdbcType=DECIMAL} and b.PI_ID = #{piId,jdbcType=DECIMAL}
    </select>
    <select id="selectChannelProductRealByFundCode" resultMap="productRealMap" parameterType="hashMap">
		select
        <include refid="Base_Column_List"/>
		  from P_CHANNEL_PRODUCT_RELATION t
        where  cpr_channel_code = #{CHANNELCODE,jdbcType=VARCHAR}
        and  cpr_fund_code = #{FUNDCODE,jdbcType=VARCHAR}
        and  cpr_check_state ='01'
        and  cpr_valid_flag='01'
  </select>

</mapper>