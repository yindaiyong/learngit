<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sams.sys.mapper.SysDictMapper">
    <resultMap id="BaseResultMap" type="com.sams.sys.model.SysDict">
        <id column="dict_id" jdbcType="VARCHAR" property="dictId"/>
        <result column="dict_pid" jdbcType="VARCHAR" property="dictPid"/>
        <result column="dict_type" jdbcType="VARCHAR" property="dictType"/>
        <result column="dict_code" jdbcType="VARCHAR" property="dictCode"/>
        <result column="dict_name" jdbcType="VARCHAR" property="dictName"/>
        <result column="dict_flag" jdbcType="VARCHAR" property="dictFlag"/>
        <result column="dict_seq" jdbcType="NUMERIC" property="dictSeq"/>
        <result column="description" jdbcType="VARCHAR" property="description"/>
    </resultMap>
    <resultMap id="sysDictVoResultMap" type="com.sams.sys.model.result.SysDictVo" extends="BaseResultMap">
    </resultMap>
    <sql id="Base_Column_List">
      dict_id, dict_pid, dict_type, dict_code, dict_name, dict_flag, dict_seq, description
    </sql>

    <!--查找全部-->
    <select id="findDicAlltVo" resultMap="sysDictVoResultMap" parameterType="java.lang.String">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_dict
        <if test="dictType != null and dictType != ''">
            WHERE dict_type = #{dictType, jdbcType=VARCHAR}
        </if>
        order by  dict_code asc,dict_seq asc
    </select>
    
     <!--查找fundStatus-->
    <select id="findFundStatus" resultType="Map" parameterType="java.lang.String">
        SELECT
        dict_code fmFundStatus,dict_name fmFundStatusName
        FROM sys_dict
        <if test="dictType != null and dictType != ''">
            WHERE dict_type = #{dictType, jdbcType=VARCHAR} and dict_code!=' '
        </if>
        order by dict_seq
    </select>
	
	<select id="findDealTypeByChannelCode" resultMap="sysDictVoResultMap" parameterType="Map">
		select * from sys_dict d where d.dict_pid is not null
    	AND SUBSTR(D.DICT_TYPE,0,1) IN 
		(select DISTINCT T.PI_PRODUCT_TYPE from p_product_info t 
			where t.pi_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
			AND T.PI_VALID_FLAG NOT IN ('00','99') 
			AND T.PI_CHECK_STATE = '01'
		)
	    start with d.dict_type = 'dealType'
	    connect by prior d.dict_id = d.dict_pid 
	</select>
    
    
    <!--通过条件查询-->
    <select id="findDictVo" resultType="java.lang.String" parameterType="java.lang.String">
        SELECT dict_code
        FROM sys_dict
        <where>
            <if test="dictType != null">
                 dict_type = #{dictType, jdbcType=VARCHAR}
            </if>
        </where>
        order by dict_seq
    </select>
    
    
    <select id="findDictBydictCodeVo" resultType="java.lang.String" parameterType="hashMap">
        SELECT dict_code
        FROM sys_dict
        <where>
            <if test="dictType != null and dictType != ''">
                AND dict_type = #{dictType, jdbcType=VARCHAR}
            </if>
            <if test="dictCode != null and dictCode != '' ">
                AND dict_code = #{dictCode, jdbcType=VARCHAR}
            </if>
        </where>
        order by dict_seq
    </select>
    
    <select id="findDictCount" resultType="int" parameterType="hashMap">
        SELECT count(*)
        FROM sys_dict
        <where>
            <if test="dictType != null and dictType != ''">
                AND dict_type = #{dictType, jdbcType=VARCHAR}
            </if>
            <if test="dictCode != null and dictCode != '' ">
                AND dict_code = #{dictCode, jdbcType=VARCHAR}
            </if>
        </where>
    </select>
    

    <!--通过条件查询-->
    <select id="findByCondition" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM sys_dict
        <where>
            <if test="condition.dictType != null">
                AND dict_type = #{condition.dictType, jdbcType=VARCHAR}
            </if>
            <if test="condition.dictCode != null">
                AND dict_code = #{condition.dictCode, jdbcType=VARCHAR}
            </if>
        </where>
        order by dict_seq
    </select>

	<select id="findChildByDictType" resultMap="BaseResultMap">
		SELECT
        <include refid="Base_Column_List"/>
        FROM sys_dict where dict_pid in (select dict_id from　sys_dict where dict_type = #{dictType, jdbcType=VARCHAR})
	</select>
	
	<select id="queryTaTcapType" resultType="Map">
		select c_serialno dictCode,c_sourcename dictName from ta_tcapType
	</select>
	
	<select id="getRoleId" resultType="Map">
		SELECT SR.ROLE_ID ROLEID,SR.ROLE_NAME ROLENAME FROM SYS_ROLE SR
	</select>
	
	<select id="getSysDictInfo" resultType="Map" parameterType="java.lang.String">
		select  dict_type dictType,dict_code dictCode  from sys_dict d where d.dict_pid is not null
	    start with d.dict_type = #{dictType, jdbcType=VARCHAR}
	    connect by prior d.dict_id = d.dict_pid 
	</select>

    <select id="selectByDictName" resultType="hashmap">
         select dict_code dictCode, dict_name dictName
   from sys_dict
    <choose>
        <when test="dictName == 'fundType'">
            where dict_type = #{dictName,jdbcType=VARCHAR} and dict_code is not null
        </when>
        <otherwise>
            where dict_pid =
            (select dict_id from sys_dict where dict_type = #{dictName,jdbcType=VARCHAR})
        </otherwise>
    </choose>
        order by dict_code asc
    </select>
	
</mapper>