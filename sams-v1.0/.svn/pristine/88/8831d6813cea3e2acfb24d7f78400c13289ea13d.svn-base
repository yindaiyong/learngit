<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sams.custom.mapper.FundVolDetailCfmMapper" >
  <resultMap id="BaseResultMap" type="com.sams.custom.model.FundVolDetailCfm" >
    <id column="FVD_ID" property="fvdId" jdbcType="DECIMAL" />
    <result column="FVD_CHANNEL_CODE" property="fvdChannelCode" jdbcType="VARCHAR" />
    <result column="FVD_TRANS_DATE" property="fvdTransDate" jdbcType="VARCHAR" />
    <result column="FVD_AVAILABLE_VOL" property="fvdAvailableVol" jdbcType="DECIMAL" />
    <result column="FVD_TOTAL_VOL_OF_DISTRIBUTOR" property="fvdTotalVolOfDistributor" jdbcType="DECIMAL" />
    <result column="FVD_TRANSACTION_CFM_DATE" property="fvdTransactionCfmDate" jdbcType="VARCHAR" />
    <result column="FVD_FUND_CODE" property="fvdFundCode" jdbcType="VARCHAR" />
    <result column="FVD_TRANSACTION_ACCOUNT_ID" property="fvdTransactionAccountId" jdbcType="VARCHAR" />
    <result column="FVD_DISTRIBUTOR_CODE" property="fvdDistributorCode" jdbcType="VARCHAR" />
    <result column="FVD_TA_ACCOUNT_ID" property="fvdTAAccountId" jdbcType="VARCHAR" />
    <result column="FVD_TOTAL_FROZEN_VOL" property="fvdTotalFrozenVol" jdbcType="DECIMAL" />
    <result column="FVD_BRANCH_CODE" property="fvdBranchCode" jdbcType="VARCHAR" />
    <result column="FVD_TA_SERIAL_NO" property="fvdTaSerialNo" jdbcType="VARCHAR" />
    <result column="FVD_TOTAL_BACKEND_LOAD" property="fvdTotalBackendLoad" jdbcType="DECIMAL" />
    <result column="FVD_SHARE_CLASS" property="fvdShareClass" jdbcType="VARCHAR" />
    <result column="FVD_DETAIL_FLAG" property="fvdDetailFlag" jdbcType="VARCHAR" />
    <result column="FVD_ACCOUNT_STATUS" property="fvdAccountStatus" jdbcType="VARCHAR" />
    <result column="FVD_SHARE_REGISTER_DATE" property="fvdShareRegisterDate" jdbcType="VARCHAR" />
    <result column="FVD_UNDISTRIBUTE_MONETARY" property="fvdUndistributeMonetary" jdbcType="DECIMAL" />
    <result column="FVD_UNDISTRIBUTE_MONETARY_FLAG" property="fvdUndistributeMonetaryFlag" jdbcType="VARCHAR" />
    <result column="FVD_GUARANTEED_AMOUNT" property="fvdGuaranteedAmount" jdbcType="DECIMAL" />
    <result column="FVD_SOURCE_TYPE" property="fvdSourceType" jdbcType="VARCHAR" />
    <result column="FVD_DEF_DIVIDEND_METHOD" property="fvdDefDividendMethod" jdbcType="VARCHAR" />
    <result column="FVD_ALLOW_REDEMPT_DATE" property="fvdAllowRedemptDate" jdbcType="VARCHAR" />
    <result column="FVD_SEND_STATUS" property="fvdSendStatus" jdbcType="VARCHAR" />
    <result column="FVD_GENERATE_STATUS" property="fvdGenerateStatus" jdbcType="VARCHAR" />
    <result column="FVD_SEND_FILE_TIME" property="fvdSendFileTime" jdbcType="TIMESTAMP" />
    <result column="FVD_GENERATE_FILE_TIME" property="fvdGenerateFileTime" jdbcType="TIMESTAMP" />
    <result column="FVD_CTIME" property="fvdCtime" jdbcType="TIMESTAMP" />
    <result column="FVD_UTIME" property="fvdUtime" jdbcType="TIMESTAMP" />
    <result column="FVD_CUSER" property="fvdCuser" jdbcType="VARCHAR" />
    <result column="FVD_UUSER" property="fvdUuser" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    FVD_ID, FVD_CHANNEL_CODE, FVD_TRANS_DATE, FVD_AVAILABLE_VOL, FVD_TOTAL_VOL_OF_DISTRIBUTOR, 
    FVD_TRANSACTION_CFM_DATE, FVD_FUND_CODE, FVD_TRANSACTION_ACCOUNT_ID, FVD_DISTRIBUTOR_CODE, 
    FVD_TA_ACCOUNT_ID, FVD_TOTAL_FROZEN_VOL, FVD_BRANCH_CODE, FVD_TA_SERIAL_NO, FVD_TOTAL_BACKEND_LOAD, 
    FVD_SHARE_CLASS, FVD_DETAIL_FLAG, FVD_ACCOUNT_STATUS, FVD_SHARE_REGISTER_DATE, FVD_UNDISTRIBUTE_MONETARY, 
    FVD_UNDISTRIBUTE_MONETARY_FLAG, FVD_GUARANTEED_AMOUNT, FVD_SOURCE_TYPE, FVD_DEF_DIVIDEND_METHOD, 
    FVD_ALLOW_REDEMPT_DATE,FVD_SEND_STATUS,FVD_GENERATE_STATUS,FVD_SEND_FILE_TIME,FVD_GENERATE_FILE_TIME,
     FVD_CTIME, FVD_UTIME, FVD_CUSER, FVD_UUSER
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from D_FUND_VOL_DETAIL_CFM
    where FVD_ID = #{fvdId,jdbcType=DECIMAL}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    delete from D_FUND_VOL_DETAIL_CFM
    where FVD_ID = #{fvdId,jdbcType=DECIMAL}
  </delete>
  <insert id="insert" parameterType="com.sams.custom.model.FundVolDetailCfm" >
    insert into D_FUND_VOL_DETAIL_CFM (FVD_ID, FVD_CHANNEL_CODE, FVD_TRANS_DATE, 
      FVD_AVAILABLE_VOL, FVD_TOTAL_VOL_OF_DISTRIBUTOR, 
      FVD_TRANSACTION_CFM_DATE, FVD_FUND_CODE, FVD_TRANSACTION_ACCOUNT_ID, 
      FVD_DISTRIBUTOR_CODE, FVD_TA_ACCOUNT_ID, FVD_TOTAL_FROZEN_VOL, 
      FVD_BRANCH_CODE, FVD_TA_SERIAL_NO, FVD_TOTAL_BACKEND_LOAD, 
      FVD_SHARE_CLASS, FVD_DETAIL_FLAG, FVD_ACCOUNT_STATUS, 
      FVD_SHARE_REGISTER_DATE, FVD_UNDISTRIBUTE_MONETARY, 
      FVD_UNDISTRIBUTE_MONETARY_FLAG, FVD_GUARANTEED_AMOUNT, 
      FVD_SOURCE_TYPE, FVD_DEF_DIVIDEND_METHOD, FVD_ALLOW_REDEMPT_DATE,
      FVD_SEND_STATUS,FVD_GENERATE_STATUS,FVD_SEND_FILE_TIME,FVD_GENERATE_FILE_TIME,
      FVD_CTIME, FVD_UTIME, FVD_CUSER, 
      FVD_UUSER)
    values (#{fvdId,jdbcType=DECIMAL}, #{fvdChannelCode,jdbcType=VARCHAR}, #{fvdTransDate,jdbcType=VARCHAR}, 
      #{fvdAvailableVol,jdbcType=DECIMAL}, #{fvdTotalVolOfDistributor,jdbcType=DECIMAL}, 
      #{fvdTransactionCfmDate,jdbcType=VARCHAR}, #{fvdFundCode,jdbcType=VARCHAR}, #{fvdTransactionAccountId,jdbcType=VARCHAR}, 
      #{fvdDistributorCode,jdbcType=VARCHAR}, #{fvdTAAccountId,jdbcType=VARCHAR}, #{fvdTotalFrozenVol,jdbcType=DECIMAL}, 
      #{fvdBranchCode,jdbcType=VARCHAR}, #{fvdTaSerialNo,jdbcType=VARCHAR}, #{fvdTotalBackendLoad,jdbcType=DECIMAL}, 
      #{fvdShareClass,jdbcType=VARCHAR}, #{fvdDetailFlag,jdbcType=VARCHAR}, #{fvdAccountStatus,jdbcType=VARCHAR}, 
      #{fvdShareRegisterDate,jdbcType=VARCHAR}, #{fvdUndistributeMonetary,jdbcType=DECIMAL}, 
      #{fvdUndistributeMonetaryFlag,jdbcType=VARCHAR}, #{fvdGuaranteedAmount,jdbcType=DECIMAL}, 
      #{fvdSourceType,jdbcType=VARCHAR}, #{fvdDefDividendMethod,jdbcType=VARCHAR}, #{fvdAllowRedemptDate,jdbcType=VARCHAR}, 
      #{fvdSendStatus,jdbcType=TIMESTAMP},
      #{fvdGenerateStatus,jdbcType=TIMESTAMP},
      #{fvdSendFileTime,jdbcType=TIMESTAMP},
      #{fvdGenerateFileTime,jdbcType=TIMESTAMP},
      #{fvdCtime,jdbcType=TIMESTAMP}, #{fvdUtime,jdbcType=TIMESTAMP}, #{fvdCuser,jdbcType=VARCHAR},
      #{fvdUuser,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.sams.custom.model.FundVolDetailCfm" >
    insert into D_FUND_VOL_DETAIL_CFM
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="fvdId != null" >
        FVD_ID,
      </if>
      <if test="fvdChannelCode != null" >
        FVD_CHANNEL_CODE,
      </if>
      <if test="fvdTransDate != null" >
        FVD_TRANS_DATE,
      </if>
      <if test="fvdAvailableVol != null" >
        FVD_AVAILABLE_VOL,
      </if>
      <if test="fvdTotalVolOfDistributor != null" >
        FVD_TOTAL_VOL_OF_DISTRIBUTOR,
      </if>
      <if test="fvdTransactionCfmDate != null" >
        FVD_TRANSACTION_CFM_DATE,
      </if>
      <if test="fvdFundCode != null" >
        FVD_FUND_CODE,
      </if>
      <if test="fvdTransactionAccountId != null" >
        FVD_TRANSACTION_ACCOUNT_ID,
      </if>
      <if test="fvdDistributorCode != null" >
        FVD_DISTRIBUTOR_CODE,
      </if>
      <if test="fvdTAAccountId != null" >
        FVD_TA_ACCOUNT_ID,
      </if>
      <if test="fvdTotalFrozenVol != null" >
        FVD_TOTAL_FROZEN_VOL,
      </if>
      <if test="fvdBranchCode != null" >
        FVD_BRANCH_CODE,
      </if>
      <if test="fvdTaSerialNo != null" >
        FVD_TA_SERIAL_NO,
      </if>
      <if test="fvdTotalBackendLoad != null" >
        FVD_TOTAL_BACKEND_LOAD,
      </if>
      <if test="fvdShareClass != null" >
        FVD_SHARE_CLASS,
      </if>
      <if test="fvdDetailFlag != null" >
        FVD_DETAIL_FLAG,
      </if>
      <if test="fvdAccountStatus != null" >
        FVD_ACCOUNT_STATUS,
      </if>
      <if test="fvdShareRegisterDate != null" >
        FVD_SHARE_REGISTER_DATE,
      </if>
      <if test="fvdUndistributeMonetary != null" >
        FVD_UNDISTRIBUTE_MONETARY,
      </if>
      <if test="fvdUndistributeMonetaryFlag != null" >
        FVD_UNDISTRIBUTE_MONETARY_FLAG,
      </if>
      <if test="fvdGuaranteedAmount != null" >
        FVD_GUARANTEED_AMOUNT,
      </if>
      <if test="fvdSourceType != null" >
        FVD_SOURCE_TYPE,
      </if>
      <if test="fvdDefDividendMethod != null" >
        FVD_DEF_DIVIDEND_METHOD,
      </if>
      <if test="fvdAllowRedemptDate != null" >
        FVD_ALLOW_REDEMPT_DATE,
      </if>
      <if test="fvdCtime != null" >
        FVD_CTIME,
      </if>
      <if test="fvdUtime != null" >
        FVD_UTIME,
      </if>
      <if test="fvdCuser != null" >
        FVD_CUSER,
      </if>
      <if test="fvdUuser != null" >
        FVD_UUSER,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="fvdId != null" >
        #{fvdId,jdbcType=DECIMAL},
      </if>
      <if test="fvdChannelCode != null" >
        #{fvdChannelCode,jdbcType=VARCHAR},
      </if>
      <if test="fvdTransDate != null" >
        #{fvdTransDate,jdbcType=VARCHAR},
      </if>
      <if test="fvdAvailableVol != null" >
        #{fvdAvailableVol,jdbcType=DECIMAL},
      </if>
      <if test="fvdTotalVolOfDistributor != null" >
        #{fvdTotalVolOfDistributor,jdbcType=DECIMAL},
      </if>
      <if test="fvdTransactionCfmDate != null" >
        #{fvdTransactionCfmDate,jdbcType=VARCHAR},
      </if>
      <if test="fvdFundCode != null" >
        #{fvdFundCode,jdbcType=VARCHAR},
      </if>
      <if test="fvdTransactionAccountId != null" >
        #{fvdTransactionAccountId,jdbcType=VARCHAR},
      </if>
      <if test="fvdDistributorCode != null" >
        #{fvdDistributorCode,jdbcType=VARCHAR},
      </if>
      <if test="fvdTAAccountId != null" >
        #{fvdTAAccountId,jdbcType=VARCHAR},
      </if>
      <if test="fvdTotalFrozenVol != null" >
        #{fvdTotalFrozenVol,jdbcType=DECIMAL},
      </if>
      <if test="fvdBranchCode != null" >
        #{fvdBranchCode,jdbcType=VARCHAR},
      </if>
      <if test="fvdTaSerialNo != null" >
        #{fvdTaSerialNo,jdbcType=VARCHAR},
      </if>
      <if test="fvdTotalBackendLoad != null" >
        #{fvdTotalBackendLoad,jdbcType=DECIMAL},
      </if>
      <if test="fvdShareClass != null" >
        #{fvdShareClass,jdbcType=VARCHAR},
      </if>
      <if test="fvdDetailFlag != null" >
        #{fvdDetailFlag,jdbcType=VARCHAR},
      </if>
      <if test="fvdAccountStatus != null" >
        #{fvdAccountStatus,jdbcType=VARCHAR},
      </if>
      <if test="fvdShareRegisterDate != null" >
        #{fvdShareRegisterDate,jdbcType=VARCHAR},
      </if>
      <if test="fvdUndistributeMonetary != null" >
        #{fvdUndistributeMonetary,jdbcType=DECIMAL},
      </if>
      <if test="fvdUndistributeMonetaryFlag != null" >
        #{fvdUndistributeMonetaryFlag,jdbcType=VARCHAR},
      </if>
      <if test="fvdGuaranteedAmount != null" >
        #{fvdGuaranteedAmount,jdbcType=DECIMAL},
      </if>
      <if test="fvdSourceType != null" >
        #{fvdSourceType,jdbcType=VARCHAR},
      </if>
      <if test="fvdDefDividendMethod != null" >
        #{fvdDefDividendMethod,jdbcType=VARCHAR},
      </if>
      <if test="fvdAllowRedemptDate != null" >
        #{fvdAllowRedemptDate,jdbcType=VARCHAR},
      </if>
      <if test="fvdCtime != null" >
        #{fvdCtime,jdbcType=TIMESTAMP},
      </if>
      <if test="fvdUtime != null" >
        #{fvdUtime,jdbcType=TIMESTAMP},
      </if>
      <if test="fvdCuser != null" >
        #{fvdCuser,jdbcType=VARCHAR},
      </if>
      <if test="fvdUuser != null" >
        #{fvdUuser,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.sams.custom.model.FundVolDetailCfm" >
    update D_FUND_VOL_DETAIL_CFM
    <set >
      <if test="fvdChannelCode != null" >
        FVD_CHANNEL_CODE = #{fvdChannelCode,jdbcType=VARCHAR},
      </if>
      <if test="fvdTransDate != null" >
        FVD_TRANS_DATE = #{fvdTransDate,jdbcType=VARCHAR},
      </if>
      <if test="fvdAvailableVol != null" >
        FVD_AVAILABLE_VOL = #{fvdAvailableVol,jdbcType=DECIMAL},
      </if>
      <if test="fvdTotalVolOfDistributor != null" >
        FVD_TOTAL_VOL_OF_DISTRIBUTOR = #{fvdTotalVolOfDistributor,jdbcType=DECIMAL},
      </if>
      <if test="fvdTransactionCfmDate != null" >
        FVD_TRANSACTION_CFM_DATE = #{fvdTransactionCfmDate,jdbcType=VARCHAR},
      </if>
      <if test="fvdFundCode != null" >
        FVD_FUND_CODE = #{fvdFundCode,jdbcType=VARCHAR},
      </if>
      <if test="fvdTransactionAccountId != null" >
        FVD_TRANSACTION_ACCOUNT_ID = #{fvdTransactionAccountId,jdbcType=VARCHAR},
      </if>
      <if test="fvdDistributorCode != null" >
        FVD_DISTRIBUTOR_CODE = #{fvdDistributorCode,jdbcType=VARCHAR},
      </if>
      <if test="fvdTAAccountId != null" >
        FVD_TA_ACCOUNT_ID = #{fvdTAAccountId,jdbcType=VARCHAR},
      </if>
      <if test="fvdTotalFrozenVol != null" >
        FVD_TOTAL_FROZEN_VOL = #{fvdTotalFrozenVol,jdbcType=DECIMAL},
      </if>
      <if test="fvdBranchCode != null" >
        FVD_BRANCH_CODE = #{fvdBranchCode,jdbcType=VARCHAR},
      </if>
      <if test="fvdTaSerialNo != null" >
        FVD_TA_SERIAL_NO = #{fvdTaSerialNo,jdbcType=VARCHAR},
      </if>
      <if test="fvdTotalBackendLoad != null" >
        FVD_TOTAL_BACKEND_LOAD = #{fvdTotalBackendLoad,jdbcType=DECIMAL},
      </if>
      <if test="fvdShareClass != null" >
        FVD_SHARE_CLASS = #{fvdShareClass,jdbcType=VARCHAR},
      </if>
      <if test="fvdDetailFlag != null" >
        FVD_DETAIL_FLAG = #{fvdDetailFlag,jdbcType=VARCHAR},
      </if>
      <if test="fvdAccountStatus != null" >
        FVD_ACCOUNT_STATUS = #{fvdAccountStatus,jdbcType=VARCHAR},
      </if>
      <if test="fvdShareRegisterDate != null" >
        FVD_SHARE_REGISTER_DATE = #{fvdShareRegisterDate,jdbcType=VARCHAR},
      </if>
      <if test="fvdUndistributeMonetary != null" >
        FVD_UNDISTRIBUTE_MONETARY = #{fvdUndistributeMonetary,jdbcType=DECIMAL},
      </if>
      <if test="fvdUndistributeMonetaryFlag != null" >
        FVD_UNDISTRIBUTE_MONETARY_FLAG = #{fvdUndistributeMonetaryFlag,jdbcType=VARCHAR},
      </if>
      <if test="fvdGuaranteedAmount != null" >
        FVD_GUARANTEED_AMOUNT = #{fvdGuaranteedAmount,jdbcType=DECIMAL},
      </if>
      <if test="fvdSourceType != null" >
        FVD_SOURCE_TYPE = #{fvdSourceType,jdbcType=VARCHAR},
      </if>
      <if test="fvdDefDividendMethod != null" >
        FVD_DEF_DIVIDEND_METHOD = #{fvdDefDividendMethod,jdbcType=VARCHAR},
      </if>
      <if test="fvdAllowRedemptDate != null" >
        FVD_ALLOW_REDEMPT_DATE = #{fvdAllowRedemptDate,jdbcType=VARCHAR},
      </if>
      <if test="fvdCtime != null" >
        FVD_CTIME = #{fvdCtime,jdbcType=TIMESTAMP},
      </if>
      <if test="fvdUtime != null" >
        FVD_UTIME = #{fvdUtime,jdbcType=TIMESTAMP},
      </if>
      <if test="fvdCuser != null" >
        FVD_CUSER = #{fvdCuser,jdbcType=VARCHAR},
      </if>
      <if test="fvdUuser != null" >
        FVD_UUSER = #{fvdUuser,jdbcType=VARCHAR},
      </if>
    </set>
    where FVD_ID = #{fvdId,jdbcType=DECIMAL}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.sams.custom.model.FundVolDetailCfm" >
    update D_FUND_VOL_DETAIL_CFM
    set FVD_CHANNEL_CODE = #{fvdChannelCode,jdbcType=VARCHAR},
      FVD_TRANS_DATE = #{fvdTransDate,jdbcType=VARCHAR},
      FVD_AVAILABLE_VOL = #{fvdAvailableVol,jdbcType=DECIMAL},
      FVD_TOTAL_VOL_OF_DISTRIBUTOR = #{fvdTotalVolOfDistributor,jdbcType=DECIMAL},
      FVD_TRANSACTION_CFM_DATE = #{fvdTransactionCfmDate,jdbcType=VARCHAR},
      FVD_FUND_CODE = #{fvdFundCode,jdbcType=VARCHAR},
      FVD_TRANSACTION_ACCOUNT_ID = #{fvdTransactionAccountId,jdbcType=VARCHAR},
      FVD_DISTRIBUTOR_CODE = #{fvdDistributorCode,jdbcType=VARCHAR},
      FVD_TA_ACCOUNT_ID = #{fvdTAAccountId,jdbcType=VARCHAR},
      FVD_TOTAL_FROZEN_VOL = #{fvdTotalFrozenVol,jdbcType=DECIMAL},
      FVD_BRANCH_CODE = #{fvdBranchCode,jdbcType=VARCHAR},
      FVD_TA_SERIAL_NO = #{fvdTaSerialNo,jdbcType=VARCHAR},
      FVD_TOTAL_BACKEND_LOAD = #{fvdTotalBackendLoad,jdbcType=DECIMAL},
      FVD_SHARE_CLASS = #{fvdShareClass,jdbcType=VARCHAR},
      FVD_DETAIL_FLAG = #{fvdDetailFlag,jdbcType=VARCHAR},
      FVD_ACCOUNT_STATUS = #{fvdAccountStatus,jdbcType=VARCHAR},
      FVD_SHARE_REGISTER_DATE = #{fvdShareRegisterDate,jdbcType=VARCHAR},
      FVD_UNDISTRIBUTE_MONETARY = #{fvdUndistributeMonetary,jdbcType=DECIMAL},
      FVD_UNDISTRIBUTE_MONETARY_FLAG = #{fvdUndistributeMonetaryFlag,jdbcType=VARCHAR},
      FVD_GUARANTEED_AMOUNT = #{fvdGuaranteedAmount,jdbcType=DECIMAL},
      FVD_SOURCE_TYPE = #{fvdSourceType,jdbcType=VARCHAR},
      FVD_DEF_DIVIDEND_METHOD = #{fvdDefDividendMethod,jdbcType=VARCHAR},
      FVD_ALLOW_REDEMPT_DATE = #{fvdAllowRedemptDate,jdbcType=VARCHAR},
      FVD_CTIME = #{fvdCtime,jdbcType=TIMESTAMP},
      FVD_UTIME = #{fvdUtime,jdbcType=TIMESTAMP},
      FVD_CUSER = #{fvdCuser,jdbcType=VARCHAR},
      FVD_UUSER = #{fvdUuser,jdbcType=VARCHAR}
    where FVD_ID = #{fvdId,jdbcType=DECIMAL}
  </update>
  <!--从TA视图获取对应的份额明细数据-->
  <select id="getFundVolDetailFromTA" resultMap="BaseResultMap">
    select t1.dci_channel_code FVD_CHANNEL_CODE,
       #{transDate,jdbcType=VARCHAR} FVD_TRANS_DATE,
       t2.F_SHARES_VALID FVD_AVAILABLE_VOL,
       t2.F_SHARES_ALL FVD_TOTAL_VOL_OF_DISTRIBUTOR,
       to_char(t2.D_CDATE,'YYYYMMDD') FVD_TRANSACTION_CFM_DATE,
       t1.dci_fund_code FVD_FUND_CODE,
       t1.dci_trans_action_account FVD_TRANSACTION_ACCOUNT_ID,
       t1.dci_distributor_code FVD_DISTRIBUTOR_CODE,
       t1.Dci_Ta_Account_Id FVD_TA_ACCOUNT_ID,
       t2.F_SHARES_FROZEN FVD_TOTAL_FROZEN_VOL,
       t1.Dci_Branch_Code FVD_BRANCH_CODE,
       t2.C_CSERIALNO FVD_TA_SERIAL_NO,
       '0' FVD_TOTAL_BACKEND_LOAD,
       '0' FVD_SHARE_CLASS,
       t2.C_DETAILFLAG FVD_DETAIL_FLAG,
       '1' FVD_ACCOUNT_STATUS,
       to_char(t2.d_registdate,'YYYYMMDD') FVD_SHARE_REGISTER_DATE,
       '' FVD_UNDISTRIBUTE_MONETARY,
       '' FVD_UNDISTRIBUTE_MONETARY_FLAG,
       '' FVD_GUARANTEED_AMOUNT,
       t2.c_sourcetype FVD_SOURCE_TYPE,
       '' FVD_DEF_DIVIDEND_METHOD,
       to_char(t2.d_AllowRedeemDate,'YYYYMMDD') FVD_ALLOW_REDEMPT_DATE
  from d_contract_info t1, v_shares_status t2
 where t1.dci_in_contract = t2.l_contractserialno
   and t1.dci_product_code = t2.c_fundcode
   and t1.dci_channel_code = #{channelCode,jdbcType=VARCHAR}
    and t1.dci_valid_flag = '01'
    and exists (
    select 1 from p_product_info p
    where p.pi_channel_code = t1.dci_channel_code
    and p.pi_channel_product_code = t1.dci_fund_code
    and p.pi_valid_flag not in ('00','99')
    and p.pi_pro_setup_date &lt;#{transDate,jdbcType=VARCHAR}
    and p.pi_product_type in
    <foreach collection="productTypes" separator="," index="index" item="item" close=")" open="(">
      #{item,jdbcType=VARCHAR}
    </foreach>
    )
    <!-- 20200326 新增只取除了122和130确认成功的交易 -->
    and exists (
    	select 1 from ta_trequest r where exists (
			select 1 from d_exchange_req_cfm t where t.erc_business_code in ('022','130') and t.erc_return_code = '0000' 
				and exists (
				select 1 from p_product_info p
				where p.pi_channel_code = t.erc_channel_code
				and t.erc_channel_code = #{channelCode,jdbcType=VARCHAR}
				and p.pi_channel_product_code = t.erc_fund_code
				and p.pi_valid_flag not in ('00','99')
				and p.pi_pro_setup_date &lt;#{transDate,jdbcType=VARCHAR}
				and p.pi_product_type in 
				<foreach collection="productTypes" separator="," index="index" item="item" close=")" open="(">
			      #{item,jdbcType=VARCHAR}
			    </foreach>
				)
			and t.erc_ta_serial_no = r.c_outrequestno
		) 
	and r.c_requestno =t2.c_requestno  
    )
  </select>

  <insert id="insertByBatch">
    insert
    <foreach collection="list" index="index" item="item" open="All" close="SELECT 1 FROM DUAL">
    into D_FUND_VOL_DETAIL_CFM (FVD_ID, FVD_CHANNEL_CODE, FVD_TRANS_DATE,
      FVD_AVAILABLE_VOL, FVD_TOTAL_VOL_OF_DISTRIBUTOR,
      FVD_TRANSACTION_CFM_DATE, FVD_FUND_CODE, FVD_TRANSACTION_ACCOUNT_ID,
      FVD_DISTRIBUTOR_CODE, FVD_TA_ACCOUNT_ID, FVD_TOTAL_FROZEN_VOL,
      FVD_BRANCH_CODE, FVD_TA_SERIAL_NO, FVD_TOTAL_BACKEND_LOAD,
      FVD_SHARE_CLASS, FVD_DETAIL_FLAG, FVD_ACCOUNT_STATUS,
      FVD_SHARE_REGISTER_DATE, FVD_UNDISTRIBUTE_MONETARY,
      FVD_UNDISTRIBUTE_MONETARY_FLAG, FVD_GUARANTEED_AMOUNT,
      FVD_SOURCE_TYPE, FVD_DEF_DIVIDEND_METHOD, FVD_ALLOW_REDEMPT_DATE)
    values (#{item.fvdId,jdbcType=DECIMAL}, #{item.fvdChannelCode,jdbcType=VARCHAR}, #{item.fvdTransDate,jdbcType=VARCHAR},
      #{item.fvdAvailableVol,jdbcType=DECIMAL}, #{item.fvdTotalVolOfDistributor,jdbcType=DECIMAL},
      #{item.fvdTransactionCfmDate,jdbcType=VARCHAR}, #{item.fvdFundCode,jdbcType=VARCHAR}, #{item.fvdTransactionAccountId,jdbcType=VARCHAR},
      #{item.fvdDistributorCode,jdbcType=VARCHAR}, #{item.fvdTAAccountId,jdbcType=VARCHAR}, #{item.fvdTotalFrozenVol,jdbcType=DECIMAL},
      #{item.fvdBranchCode,jdbcType=VARCHAR}, #{item.fvdTaSerialNo,jdbcType=VARCHAR}, #{item.fvdTotalBackendLoad,jdbcType=DECIMAL},
      #{item.fvdShareClass,jdbcType=VARCHAR}, #{item.fvdDetailFlag,jdbcType=VARCHAR}, #{item.fvdAccountStatus,jdbcType=VARCHAR},
      #{item.fvdShareRegisterDate,jdbcType=VARCHAR}, #{item.fvdUndistributeMonetary,jdbcType=DECIMAL},
      #{item.fvdUndistributeMonetaryFlag,jdbcType=VARCHAR}, #{item.fvdGuaranteedAmount,jdbcType=DECIMAL},
      #{item.fvdSourceType,jdbcType=VARCHAR}, #{item.fvdDefDividendMethod,jdbcType=VARCHAR}, #{item.fvdAllowRedemptDate,jdbcType=VARCHAR})
    </foreach>
  </insert>
  <!--删除交易日下的份额确认表数据-->
  <delete id="deleteByTransDate">
    delete from D_FUND_VOL_DETAIL_CFM
    where
    <choose>
      <when test="channelCode == null">
        1 != 1
      </when>
      <otherwise>
        FVD_TRANS_DATE = #{transDate,jdbcType=VARCHAR}
        and FVD_CHANNEL_CODE = #{channelCode,jdbcType=VARCHAR}
      </otherwise>
    </choose>
  </delete>
  <!--更新生成文件时间以及状态-->
  <update id="updateGenerateStaAndTime" parameterType="hashmap">
    update D_FUND_VOL_DETAIL_CFM set
 fvd_GENERATE_STATUS = '01' ,fvd_GENERATE_FILE_TIME = sysdate
 where fvd_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
 AND fvd_TRANS_DATE = #{TRANSDATE,jdbcType = VARCHAR}
  </update>
  <!--更新发送文件时间以及状态-->
  <update id="updateSendStaAndTime" parameterType="hashmap">
    update D_FUND_VOL_DETAIL_CFM set
 fvd_send_STATUS = '01' ,fvd_send_FILE_TIME = sysdate
 where fvd_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
 AND fvd_TRANS_DATE = #{TRANSDATE,jdbcType = VARCHAR}
 and fvd_GENERATE_STATUS = '01'
  </update>
  <!--根据条件获取符合条件的份额明细数据-->
  <select id="selectFundVolDetail" resultMap="BaseResultMap">
    select
    <include refid="Base_Column_List"/>
    from D_FUND_VOL_DETAIL_CFM t
    where 1 = 1
    <if test="condition.ciChannelCode != null and condition.ciChannelCode != ''  ">
      AND t.FVD_CHANNEL_CODE like  ('%'|| #{condition.ciChannelCode} ||'%')
    </if>
    <if test="condition.transDate != null and condition.transDate != ''  ">
      AND t.FVD_SHARE_REGISTER_DATE = #{condition.transDate}
    </if>
    <if test="condition.transDateCfm != null and condition.transDateCfm != ''  ">
      AND t.FVD_TRANS_DATE = #{condition.transDateCfm}
    </if>
    <if test="condition.transDateAllow != null and condition.transDateAllow != ''  ">
      AND t.FVD_ALLOW_REDEMPT_DATE = #{condition.transDateAllow}
    </if>
    <if test="pageInfo.sort != null and pageInfo.sort != ''">
      order by ${pageInfo.sort} ${pageInfo.order}
    </if>
  </select>
  
  <select id="checkRedeemAvailableVol" parameterType="map" resultType="integer">
  select count(1)
  from (select tt.availableVol - ttt.applicationvol countflag
          from (select nvl(t1.availableVol, 0) - nvl(t2.availableVol, 0) availableVol,
                       t1.fvd_channel_code,
                       t1.fvd_fund_code,
                       t1.fvd_transaction_account_id
                  from (select sum(t.fvd_available_vol) availableVol,
                               t.fvd_channel_code,
                               t.fvd_fund_code,
                               t.fvd_transaction_account_id
                          from d_fund_vol_detail_cfm t
                         where t.fvd_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
                           and t.fvd_trans_date = #{LASTDATE,jdbcType = VARCHAR}
                         group by t.fvd_channel_code,
                                  t.fvd_fund_code,
                                  t.fvd_transaction_account_id) t1
                  left join (select sum(t.fvd_available_vol) availableVol,
                                   t.fvd_channel_code,
                                   t.fvd_fund_code,
                                   t.fvd_transaction_account_id
                              from d_fund_vol_detail_cfm t
                             where t.fvd_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
                               and t.fvd_trans_date = #{TRANSDATE,jdbcType = VARCHAR}
                             group by t.fvd_channel_code,
                                      t.fvd_fund_code,
                                      t.fvd_transaction_account_id) t2
                    on t1.fvd_channel_code = t2.fvd_channel_code
                   and t1.fvd_fund_code = t2.fvd_fund_code
                   and t1.fvd_transaction_account_id =
                       t2.fvd_transaction_account_id) tt,
               (select sum(e.er_application_vol) applicationvol,
                       e.er_channel_code,
                       e.er_fund_code,
                       e.er_transaction_account_id
                  from d_exchange_req e
                 where e.er_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
                   and e.er_trans_date = #{LASTDATE,jdbcType = VARCHAR}
                   and e.er_business_code = '024'
                   and e.er_return_code = '0000'
                   and e.er_valid_flag = '01'
                 group by e.er_channel_code,
                          e.er_fund_code,
                          e.er_transaction_account_id) ttt
         where ttt.er_channel_code = tt.fvd_channel_code
           and ttt.er_fund_code = tt.fvd_fund_code
           and ttt.er_transaction_account_id = tt.fvd_transaction_account_id) pp
 where pp.countflag != 0
  </select>
  
  <select id="checkRedeemCfmTotalVol" parameterType="map" resultType="integer">
  	select count(1)
  from (select tt.totalVol - ttt.confirmedvol countflag
          from (select nvl(t1.totalVol, 0) - nvl(t2.totalVol, 0) totalVol,
                       t1.fvd_channel_code,
                       t1.fvd_fund_code,
                       t1.fvd_transaction_account_id
                  from (select sum(t.fvd_total_vol_of_distributor) totalVol,
                               t.fvd_channel_code,
                               t.fvd_fund_code,
                               t.fvd_transaction_account_id
                          from d_fund_vol_detail_cfm t
                         where t.fvd_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
                           and t.fvd_trans_date = #{LASTDATE,jdbcType = VARCHAR}
                         group by t.fvd_channel_code,
                                  t.fvd_fund_code,
                                  t.fvd_transaction_account_id) t1
                  left join (select sum(t.fvd_total_vol_of_distributor) totalVol,
                                   t.fvd_channel_code,
                                   t.fvd_fund_code,
                                   t.fvd_transaction_account_id
                              from d_fund_vol_detail_cfm t
                             where t.fvd_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
                               and t.fvd_trans_date = #{TRANSDATE,jdbcType = VARCHAR}
                             group by t.fvd_channel_code,
                                      t.fvd_fund_code,
                                      t.fvd_transaction_account_id) t2
                    on t1.fvd_channel_code = t2.fvd_channel_code
                   and t1.fvd_fund_code = t2.fvd_fund_code
                   and t1.fvd_transaction_account_id =
                       t2.fvd_transaction_account_id) tt,
               (select sum(e.erc_confirmed_vol) confirmedvol,
                       e.erc_channel_code,
                       e.erc_fund_code,
                       e.erc_transaction_account_id
                  from d_exchange_req_cfm e
                 where e.erc_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
                   and e.erc_trans_date = #{TRANSDATE,jdbcType = VARCHAR}
                   and e.erc_business_code = '024'
                   and e.erc_return_code = '0000'
                 group by e.erc_channel_code,
                          e.erc_fund_code,
                          e.erc_transaction_account_id) ttt
         where ttt.erc_channel_code = tt.fvd_channel_code
           and ttt.erc_fund_code = tt.fvd_fund_code
           and ttt.erc_transaction_account_id = tt.fvd_transaction_account_id) pp
 where pp.countflag != 0
  </select>
</mapper>