<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sams.custom.mapper.ContractMapper" >
  <sql id="Base_Column_List_Tmp" >
		crt_channel_code	CHANNELCODE,
		crt_trans_date	BUSINESSDATE,
		crt_fund_code	FUNDCODE,
		crt_ta_account_id	TAACCOUNTID,
		crt_transaction_account_id	TRANSACTIONACCOUNTID,
		crt_business_code	BUSINESSCODE,
		crt_contract_type	CONTRACTTYPE,
		crt_serial_no	SERIALNO,
		crt_version	VERSION,
		crt_sign_type	SIGNTYPE,
		crt_distributor_code	DISTRIBUTORCODE,
		crt_investor_name	INVESTORNAME,
		crt_individual_or_institution	INDIVIDUALORINSTITUTION,
		crt_certificate_type	CERTIFICATETYPE,
		crt_certificate_no	CERTIFICATENO,
		crt_transaction_date	TRANSACTIONDATE,
		crt_transaction_time	TRANSACTIONTIME,
		crt_accept_method	ACCEPTMETHOD,
		crt_accept_place	ACCEPTPLACE,
		crt_net_no	NETNO,
		crt_notes	NOTES,
		crt_sign_risk_notice	SIGNRISKNOTICE,
		crt_risk_matching	RISKMATCHING,
		crt_client_risk_rate	CLIENTRISKRATE,
		crt_alternation_date	ALTERNATIONDATE,
		crt_card_no	CARDNO,
		crt_tel_no	TELNO,
		crt_mobile_tel_no	MOBILETELNO,
		crt_email_address	EMAILADDRESS,
		crt_post_code	POSTCODE,
		crt_address	ADDRESS,
		crt_reserved_field1	RESERVEDFIELD1,
		crt_reserved_field2	RESERVEDFIELD2,
		crt_reserved_field3	RESERVEDFIELD3,
		crt_reserved_field4	RESERVEDFIELD4,
		crt_reserved_field5	RESERVEDFIELD5,
		crt_reserved_field6	RESERVEDFIELD6,
		crt_ctime	crt_ctime,
		crt_utime	crt_utime,
		crt_cuser	crt_cuser,
		crt_uuser	crt_uuser
	</sql>
 
  <sql id="Base_Column_List_Req" >
  		cr_id id,
		cr_channel_code	CHANNELCODE,
		cr_trans_date	BUSINESSDATE,
		cr_fund_code	FUNDCODE,
		cr_ta_account_id	TAACCOUNTID,
		cr_transaction_account_id	TRANSACTIONACCOUNTID,
		cr_business_code	BUSINESSCODE,
		cr_contract_type	CONTRACTTYPE,
		cr_serial_no	SERIALNO,
		cr_version	VERSION,
		cr_sign_type	SIGNTYPE,
		cr_distributor_code	DISTRIBUTORCODE,
		cr_investor_name	INVESTORNAME,
		cr_individual_or_institution	INDIVIDUALORINSTITUTION,
		cr_certificate_type	CERTIFICATETYPE,
		cr_certificate_no	CERTIFICATENO,
		cr_transaction_date	TRANSACTIONDATE,
		cr_transaction_time	TRANSACTIONTIME,
		cr_accept_method	ACCEPTMETHOD,
		cr_accept_place	ACCEPTPLACE,
		cr_net_no	NETNO,
		cr_notes	NOTES,
		cr_sign_risk_notice	SIGNRISKNOTICE,
		cr_risk_matching	RISKMATCHING,
		cr_client_risk_rate	CLIENTRISKRATE,
		cr_alternation_date	ALTERNATIONDATE,
		cr_card_no	CARDNO,
		cr_tel_no	TELNO,
		cr_mobile_tel_no	MOBILETELNO,
		cr_email_address	EMAILADDRESS,
		cr_post_code	POSTCODE,
		cr_address	ADDRESS,
		cr_reserved_field1	RESERVEDFIELD1,
		cr_reserved_field2	RESERVEDFIELD2,
		cr_reserved_field3	RESERVEDFIELD3,
		cr_reserved_field4	RESERVEDFIELD4,
		cr_reserved_field5	RESERVEDFIELD5,
		cr_reserved_field6	RESERVEDFIELD6,
		cr_valid_flag	VALIDFLAG,
		cr_error_dec	ERRORDEC,
		cr_ctime	cr_ctime,
		cr_utime	cr_utime,
		cr_cuser	cr_cuser,
		cr_uuser	cr_uuser
	</sql>
	
  <delete id="deleteContractTmpDate" parameterType="hashMap" >
    delete from D_CONTRACT_REQ_TMP
    where 1=1
    <if test="CHANNELCODE != null" >
      AND  crt_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="BUSINESSDATE != null" >
      AND  crt_trans_date=#{BUSINESSDATE,jdbcType=VARCHAR}
    </if>
  </delete>
  
  <delete id="deleteContractReqDate" parameterType="hashMap" >
    delete from d_contract_req
    where
	  <choose>
	  <when test="CHANNELCODE != null">
		  1 = 1
	  </when>
	  <otherwise>
		  1 != 1
	  </otherwise>
  </choose>
    <if test="CHANNELCODE != null" >
      AND  cr_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="BUSINESSDATE != null" >
      AND  cr_trans_date=#{BUSINESSDATE,jdbcType=VARCHAR}
    </if>
  </delete>
  
  <delete id="deleteContractCfmDate" parameterType="hashMap" >
    delete from d_contract_cfm
    where 1=1
    <if test="CHANNELCODE != null" >
      AND  cc_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="BUSINESSDATE != null" >
      AND  CC_TRANSACTION_CFM_DATE=#{BUSINESSDATE,jdbcType=VARCHAR}
    </if>
  </delete> 
  
  <select id="selectContractTmpCount" resultType="Integer" parameterType="hashMap" >
    select 
    count(*) selectCount
    from d_contract_req_tmp
    where 1=1
    <if test="CHANNELCODE != null" >
      AND  crt_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="BUSINESSDATE != null" >
      AND  crt_trans_date=#{BUSINESSDATE,jdbcType=VARCHAR}
    </if>
  </select>
  
  <select id="selectContractReqCount" resultType="Integer" parameterType="hashMap" >
    select 
    count(*) selectCount
    from d_contract_req
    where 1=1
    <if test="CHANNELCODE != null" >
      AND  cr_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="BUSINESSDATE != null" >
      AND  cr_trans_date=#{BUSINESSDATE,jdbcType=VARCHAR}
    </if>
  </select>
  
  <select id="selectContractCfmCount" resultType="Integer" parameterType="hashMap" >
    select 
    count(*) selectCount
    from d_contract_cfm
    where 1=1
    <if test="CHANNELCODE != null" >
      AND  cc_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="BUSINESSDATE != null" >
      AND  CC_TRANSACTION_CFM_DATE=#{BUSINESSDATE,jdbcType=VARCHAR}
    </if>
  </select>
	
  <insert id="insertByBatchContractTmp"  parameterType="java.util.List" >
    insert all
     <foreach collection="list" item="item" index="index">
     into d_contract_req_tmp (crt_channel_code,crt_trans_date,crt_fund_code,crt_ta_account_id,
							  crt_transaction_account_id,crt_business_code,crt_contract_type,
							  crt_serial_no,crt_version,crt_sign_type,crt_distributor_code,
							  crt_investor_name,crt_individual_or_institution,crt_certificate_type,
							  crt_certificate_no,crt_transaction_date,crt_transaction_time,
							  crt_accept_method,crt_accept_place,crt_net_no,crt_notes,crt_sign_risk_notice,
							  crt_risk_matching,crt_client_risk_rate,crt_alternation_date,crt_card_no,
							  crt_tel_no,crt_mobile_tel_no,crt_email_address,crt_post_code,crt_address,
							  crt_reserved_field1,crt_reserved_field2,crt_reserved_field3,crt_reserved_field4,
							  crt_reserved_field5    
      )
    values (
     	#{item.CHANNELCODE,jdbcType=VARCHAR},
		#{item.BUSINESSDATE,jdbcType=VARCHAR},
		#{item.FUNDCODE,jdbcType=VARCHAR},
		#{item.TAACCOUNTID,jdbcType=VARCHAR},
		#{item.TRANSACTIONACCOUNTID,jdbcType=VARCHAR},
		#{item.BUSINESSCODE,jdbcType=VARCHAR},
		#{item.CONTRACTTYPE,jdbcType=VARCHAR},
		#{item.SERIALNO,jdbcType=VARCHAR},
		#{item.VERSION,jdbcType=VARCHAR},
		#{item.SIGNTYPE,jdbcType=VARCHAR},
		#{item.DISTRIBUTORCODE,jdbcType=VARCHAR},
		#{item.INVESTORNAME,jdbcType=VARCHAR},
		#{item.INDIVIDUALORINSTITUTION,jdbcType=VARCHAR},
		#{item.CERTIFICATETYPE,jdbcType=VARCHAR},
		#{item.CERTIFICATENO,jdbcType=VARCHAR},
		#{item.TRANSACTIONDATE,jdbcType=VARCHAR},
		#{item.TRANSACTIONTIME,jdbcType=VARCHAR},
		#{item.ACCEPTMETHOD,jdbcType=VARCHAR},
		#{item.ACCEPTPLACE,jdbcType=VARCHAR},
		#{item.NETNO,jdbcType=VARCHAR},
		#{item.NOTES,jdbcType=VARCHAR},
		#{item.SIGNRISKNOTICE,jdbcType=VARCHAR},
		#{item.RISKMATCHING,jdbcType=VARCHAR},
		#{item.CLIENTRISKRATE,jdbcType=VARCHAR},
		#{item.ALTERNATIONDATE,jdbcType=VARCHAR},
		#{item.CARDNO,jdbcType=VARCHAR},
		#{item.TELNO,jdbcType=VARCHAR},
		#{item.MOBILETELNO,jdbcType=VARCHAR},
		#{item.EMAILADDRESS,jdbcType=VARCHAR},
		#{item.POSTCODE,jdbcType=VARCHAR},
		#{item.ADDRESS,jdbcType=VARCHAR},
		#{item.RESERVEDFIELD1,jdbcType=VARCHAR},
		#{item.RESERVEDFIELD2,jdbcType=VARCHAR},
		#{item.RESERVEDFIELD3,jdbcType=VARCHAR},
		#{item.RESERVEDFIELD4,jdbcType=VARCHAR},
		#{item.RESERVEDFIELD5,jdbcType=VARCHAR} 
	 )
      </foreach>
      select 1 from dual
  </insert>
  
  <insert id="insertByBatchContractReq"  parameterType="java.util.List" >
    insert all
     <foreach collection="list" item="item" index="index">
     into d_contract_req (cr_channel_code,cr_trans_date,cr_fund_code,cr_ta_account_id,
									 cr_transaction_account_id,cr_business_code,cr_contract_type,
									 cr_serial_no,cr_version,cr_sign_type,cr_distributor_code,
									 cr_investor_name,cr_individual_or_institution,cr_certificate_type,
									 cr_certificate_no,cr_transaction_date,cr_transaction_time,cr_accept_method,
									 cr_accept_place,cr_net_no,cr_notes,cr_sign_risk_notice,cr_risk_matching,
									 cr_client_risk_rate,cr_alternation_date,cr_card_no,cr_tel_no,cr_mobile_tel_no,
									 cr_email_address,cr_post_code,cr_address,cr_reserved_field1,cr_reserved_field2,
									 cr_reserved_field3,cr_reserved_field4,cr_reserved_field5,
									 cr_valid_flag,cr_error_dec       
      )values (
			#{item.CHANNELCODE,jdbcType=VARCHAR},
			#{item.BUSINESSDATE,jdbcType=VARCHAR},
			#{item.FUNDCODE,jdbcType=VARCHAR},
			#{item.TAACCOUNTID,jdbcType=VARCHAR},
			#{item.TRANSACTIONACCOUNTID,jdbcType=VARCHAR},
			#{item.BUSINESSCODE,jdbcType=VARCHAR},
			#{item.CONTRACTTYPE,jdbcType=VARCHAR},
			#{item.SERIALNO,jdbcType=VARCHAR},
			#{item.VERSION,jdbcType=VARCHAR},
			#{item.SIGNTYPE,jdbcType=VARCHAR},
			#{item.DISTRIBUTORCODE,jdbcType=VARCHAR},
			#{item.INVESTORNAME,jdbcType=VARCHAR},
			#{item.INDIVIDUALORINSTITUTION,jdbcType=VARCHAR},
			#{item.CERTIFICATETYPE,jdbcType=VARCHAR},
			#{item.CERTIFICATENO,jdbcType=VARCHAR},
			#{item.TRANSACTIONDATE,jdbcType=VARCHAR},
			#{item.TRANSACTIONTIME,jdbcType=VARCHAR},
			#{item.ACCEPTMETHOD,jdbcType=VARCHAR},
			#{item.ACCEPTPLACE,jdbcType=VARCHAR},
			#{item.NETNO,jdbcType=VARCHAR},
			#{item.NOTES,jdbcType=VARCHAR},
			#{item.SIGNRISKNOTICE,jdbcType=VARCHAR},
			#{item.RISKMATCHING,jdbcType=VARCHAR},
			#{item.CLIENTRISKRATE,jdbcType=VARCHAR},
			#{item.ALTERNATIONDATE,jdbcType=VARCHAR},
			#{item.CARDNO,jdbcType=VARCHAR},
			#{item.TELNO,jdbcType=VARCHAR},
			#{item.MOBILETELNO,jdbcType=VARCHAR},
			#{item.EMAILADDRESS,jdbcType=VARCHAR},
			#{item.POSTCODE,jdbcType=VARCHAR},
			#{item.ADDRESS,jdbcType=VARCHAR},
			#{item.RESERVEDFIELD1,jdbcType=VARCHAR},
			#{item.RESERVEDFIELD2,jdbcType=VARCHAR},
			#{item.RESERVEDFIELD3,jdbcType=VARCHAR},
			#{item.RESERVEDFIELD4,jdbcType=DECIMAL},
			#{item.RESERVEDFIELD5,jdbcType=DECIMAL},
			#{item.VALIDFLAG,jdbcType=VARCHAR},
			#{item.ERRORDEC,jdbcType=VARCHAR}      
			)
      </foreach>
      select 1 from dual
  </insert>
  
  <insert id="insertByBatchContractCfm"  parameterType="java.util.List" >
    insert all
     <foreach collection="list" item="item" index="index">
       into d_contract_cfm (cc_channel_code,cc_trans_date,cc_fund_code,cc_ta_account_id,cc_transaction_account_id,
							cc_business_code,cc_contract_type,cc_serial_no,cc_version,cc_sign_type,cc_second_status,
							cc_third_status,cc_distributor_code,cc_fund_manager_code,cc_custodian_code,cc_investor_name,
							cc_individual_or_institution,cc_certificate_type,cc_certificate_no,cc_transaction_date,cc_transaction_time,
							cc_accept_method,cc_accept_place,cc_net_no,cc_notes,cc_second_notes,cc_third_notes,cc_alternation_date,
							cc_second_date,cc_third_date,cc_sign_risk_notice,cc_risk_matching,cc_client_risk_rate,cc_card_no,
							cc_tel_no,cc_mobile_tel_no,cc_email_address,cc_post_code,cc_address,cc_reserved_field1,
							cc_reserved_field2,cc_reserved_field3,cc_reserved_field4,cc_reserved_field5,cc_reserved_field6,
							cc_check_contract_stat,cc_check_contract_detail,cc_transaction_cfm_date
      )values ( 
		 	#{item.CHANNELCODE,jdbcType=VARCHAR},
			#{item.BUSINESSDATE,jdbcType=VARCHAR},
			#{item.FUNDCODE,jdbcType=VARCHAR},
			#{item.TAACCOUNTID,jdbcType=VARCHAR},
			#{item.TRANSACTIONACCOUNTID,jdbcType=VARCHAR},
			#{item.BUSINESSCODE,jdbcType=VARCHAR},
			#{item.CONTRACTTYPE,jdbcType=VARCHAR},
			#{item.SERIALNO,jdbcType=VARCHAR},
			#{item.VERSION,jdbcType=VARCHAR},
			#{item.SIGNTYPE,jdbcType=VARCHAR},
			#{item.SECONDSTATUS,jdbcType=VARCHAR},
			#{item.THIRDSTATUS,jdbcType=VARCHAR},
			#{item.DISTRIBUTORCODE,jdbcType=VARCHAR},
			#{item.FUNDMANAGERCODE,jdbcType=VARCHAR},
			#{item.CUSTODIANCODE,jdbcType=VARCHAR},
			#{item.INVESTORNAME,jdbcType=VARCHAR},
			#{item.INDIVIDUALORINSTITUTION,jdbcType=VARCHAR},
			#{item.CERTIFICATETYPE,jdbcType=VARCHAR},
			#{item.CERTIFICATENO,jdbcType=VARCHAR},
			#{item.TRANSACTIONDATE,jdbcType=VARCHAR},
			#{item.TRANSACTIONTIME,jdbcType=VARCHAR},
			#{item.ACCEPTMETHOD,jdbcType=VARCHAR},
			#{item.ACCEPTPLACE,jdbcType=VARCHAR},
			#{item.NETNO,jdbcType=VARCHAR},
			#{item.NOTES,jdbcType=VARCHAR},
			#{item.SECONDNOTES,jdbcType=VARCHAR},
			#{item.THIRDNOTES,jdbcType=VARCHAR},
			#{item.ALTERNATIONDATE,jdbcType=VARCHAR},
			#{item.SECONDDATE,jdbcType=VARCHAR},
			#{item.THIRDDATE,jdbcType=VARCHAR},
			#{item.SIGNRISKNOTICE,jdbcType=VARCHAR},
			#{item.RISKMATCHING,jdbcType=VARCHAR},
			#{item.CLIENTRISKRATE,jdbcType=VARCHAR},
			#{item.CARDNO,jdbcType=VARCHAR},
			#{item.TELNO,jdbcType=VARCHAR},
			#{item.MOBILETELNO,jdbcType=VARCHAR},
			#{item.EMAILADDRESS,jdbcType=VARCHAR},
			#{item.POSTCODE,jdbcType=VARCHAR},
			#{item.ADDRESS,jdbcType=VARCHAR},
			#{item.RESERVEDFIELD1,jdbcType=VARCHAR},
			#{item.RESERVEDFIELD2,jdbcType=VARCHAR},
			#{item.RESERVEDFIELD3,jdbcType=VARCHAR},
			#{item.RESERVEDFIELD4,jdbcType=DECIMAL},
			#{item.RESERVEDFIELD5,jdbcType=DECIMAL},
			#{item.RESERVEDFIELD6,jdbcType=VARCHAR},
			#{item.CHECKCONTRACTSTAT,jdbcType=VARCHAR},
			#{item.CHECKCONTRACTDETAIL,jdbcType=VARCHAR},
			#{item.TRANSACTIONCFMDATE,jdbcType=VARCHAR}
      )
      </foreach>
      select 1 from dual
  </insert> 
  
  <select id="selectContractTmp" resultType = "hashMap" parameterType="hashMap" >
    select 
    <include refid="Base_Column_List_Tmp"></include> 
    from d_contract_req_tmp
    where 1=1
    <if test="CHANNELCODE != null" >
      AND  crt_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="BUSINESSDATE != null" >
      AND  crt_trans_date=#{BUSINESSDATE,jdbcType=VARCHAR}
    </if>
  </select>
  
  <select id="selectContractReq" resultType = "hashMap" parameterType="hashMap" >
    select 
    <include refid="Base_Column_List_Req"></include> 
    from d_contract_req
    where 1=1
    <if test="CHANNELCODE != null" >
      AND  cr_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="BUSINESSDATE != null" >
      AND  cr_trans_date=#{BUSINESSDATE,jdbcType=VARCHAR}
    </if>
    <if test="VALIDFLAG != null">
    	and cr_valid_flag = #{VALIDFLAG,jdbcType=VARCHAR}
    </if>
  </select>
  
  <select id="selectContractCfm" parameterType="hashMap" resultType="hashMap">
  	select 
    ${SQLNAME},t1.dict_type businesscode
    from d_contract_cfm left  join 
(SElect dict_type,dict_code  from sys_dict where dict_pid = ( select dict_id from　sys_dict where dict_type = 'bussinessCode' )) t1 on 
t1.dict_code = cc_business_code 
    where 1=1
    <if test="CHANNELCODE != null" >
      AND  cc_channel_code=#{CHANNELCODE,jdbcType=VARCHAR}
    </if>
    <if test="TRANSDATE != null" >
      AND  cc_TRANSACTION_cfm_DATE=#{TRANSDATE,jdbcType=VARCHAR}
    </if>
    order by cc_fund_code,cc_transaction_account_id
  </select>
  
  <update id="updateGenerateStaAndTime" parameterType="hashMap">
  	update d_contract_cfm set cc_GENERATE_STATUS = '01' ,cc_GENERATE_FILE_TIME = sysdate where cc_channel_code = #{CHANNELCODE,jdbcType = VARCHAR} AND cc_TRANSACTION_cfm_DATE = #{TRANSDATE,jdbcType=VARCHAR}
  </update>
  
  <update id="updateSendStaAndTime" parameterType="hashMap">
  	update d_contract_cfm set cc_SEND_STATUS = '01' , cc_SEND_FILE_TIME = sysdate where cc_channel_code = #{CHANNELCODE,jdbcType = VARCHAR} AND cc_TRANSACTION_DATE = #{TRANSDATE,jdbcType=VARCHAR} and cc_GENERATE_STATUS = '01'
  </update>
  
  <select id="getElContractData" parameterType="java.util.Map"  resultType="java.util.Map">
        select 
        cr_id ID,   
        cr_channel_code	CHANNELCODE,
		cr_trans_date	BUSINESSDATE,
		cr_fund_code	FUNDCODE,
		cr_ta_account_id	TAACCOUNTID,
		cr_transaction_account_id	TRANSACTIONACCOUNTID,
		cr_business_code	BUSINESSCODE,
		cr_contract_type	CONTRACTTYPE,
		cr_serial_no	SERIALNO,
		cr_version	VERSION,
		cr_sign_type	SIGNTYPE,
		cr_distributor_code	DISTRIBUTORCODE,
		cr_investor_name	INVESTORNAME,
		cr_individual_or_institution	INDIVIDUALORINSTITUTION,
		cr_certificate_type	CERTIFICATETYPE,
		cr_certificate_no	CERTIFICATENO,
		cr_transaction_date	TRANSACTIONDATE,
		cr_transaction_time	TRANSACTIONTIME,
		cr_accept_method	ACCEPTMETHOD,
		cr_accept_place	ACCEPTPLACE,
		cr_net_no	NETNO,
		cr_notes	NOTES,
		cr_sign_risk_notice	SIGNRISKNOTICE,
		cr_risk_matching	RISKMATCHING,
		cr_client_risk_rate	CLIENTRISKRATE,
		cr_alternation_date	ALTERNATIONDATE,
		cr_card_no	CARDNO,
		cr_tel_no	TELNO,
		cr_mobile_tel_no	MOBILETELNO,
		cr_email_address	EMAILADDRESS,
		cr_post_code	POSTCODE,
		cr_address	ADDRESS,
		cr_reserved_field1	RESERVEDFIELD1,
		cr_reserved_field2	RESERVEDFIELD2,
		cr_reserved_field3	RESERVEDFIELD3,
		cr_reserved_field4	RESERVEDFIELD4,
		cr_reserved_field5	RESERVEDFIELD5,
		cr_reserved_field6	RESERVEDFIELD6,
		cr_valid_flag	VALIDFLAG,
		cr_error_dec	ERRORDEC,
		cr_ctime	cr_ctime,
		cr_utime	cr_utime,
		cr_cuser	cr_cuser,
		cr_uuser	cr_uuser
		 from  d_contract_req where 1=1
        <if test=" condition.CHANNELCODE != null and condition.CHANNELCODE != ''  ">
                and cr_channel_code = #{condition.CHANNELCODE}
        </if>
        <if test=" condition.PRODUCTCODE != null and condition.PRODUCTCODE != ''  ">
                and cr_fund_code = #{condition.PRODUCTCODE} 
        </if>
        <if test=" condition.ECTRANSDATE != null and condition.ECTRANSDATE != '' ">
                and cr_trans_date = #{condition.ECTRANSDATE} 
        </if>
         <if test=" condition.VALIDFLAG != null and condition.VALIDFLAG != '' ">
                and cr_valid_flag = #{condition.VALIDFLAG} 
        </if>
        <if test="pageInfo.sort != null and pageInfo.sort != ''">
            order by ${pageInfo.sort} ${pageInfo.order}
        </if>
    </select>
    
    <update id="batchUpdateContractReqData" parameterType="java.util.List">
    	<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">
	    	update d_contract_req 
	    	<set>
	    		CR_VALID_FLAG = #{item.VALIDFLAG,jdbcType = VARCHAR},
	    		cr_error_dec = #{item.ERRORDEC,jdbcType = VARCHAR}
	    	</set>
	    	where cr_id = #{item.ID,jdbcType = VARCHAR}
    	</foreach>
    </update>
    
        <update id="upReturnBackElContract" parameterType="java.util.List">
			<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">	
				update d_contract_req t
			   set t.cr_valid_flag = '00', t.cr_error_dec = '手动置失败'
			 where t.cr_channel_code =#{item.CHANNELCODE,jdbcType= VARCHAR}
			   and t.cr_transaction_account_id = #{item.TRANSACTIONACCOUNTID,jdbcType= VARCHAR}
			   and t.cr_trans_date =#{item.BUSINESSDATE,jdbcType= VARCHAR}
			</foreach>
    </update>
    
    <select id="queryContractInfo" parameterType="map" resultType="map">
    	select 
    	<include refid="Base_Column_List_Req"></include> 
    	from d_contract_req t where
	    t.cr_fund_code =#{FUNDCODE,jdbcType=VARCHAR}
		and t.cr_channel_code = #{CHANNELCODE,jdbcType = VARCHAR}
		and t.cr_transaction_account_id=#{TRANSACTIONACCOUNTID,jdbcType=VARCHAR}
    	and t.cr_distributor_code=#{DISTRIBUTORCODE,jdbcType=VARCHAR}
    <if test="INDIVIDUALORINSTITUTION != null and INDIVIDUALORINSTITUTION !=''">
      	and t.cr_individual_or_institution=#{INDIVIDUALORINSTITUTION,jdbcType=VARCHAR}
    </if>
    	and t.cr_transaction_date=#{TRANSACTIONDATE,jdbcType=VARCHAR}
    </select>
</mapper>