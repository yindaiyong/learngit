<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sams.custom.mapper.ProTypeOpenDayMapper" >
  <resultMap id="BaseResultMap" type="com.sams.custom.model.ProTypeOpenDay" >
    <result column="PTO_ID" property="ptoId" jdbcType="VARCHAR" />
    <result column="PTO_CTIME" property="ptoCtime" jdbcType="TIMESTAMP" />
    <result column="PTO_UTIME" property="ptoUtime" jdbcType="TIMESTAMP" />
    <result column="PTO_CUSER" property="ptoCuser" jdbcType="VARCHAR" />
    <result column="PTO_UUSER" property="ptoUuser" jdbcType="VARCHAR" />
    <result column="PTO_PRODUCT_TYPE" property="ptoProductType" jdbcType="VARCHAR" />
    <result column="PTO_YEAR" property="ptoYear" jdbcType="VARCHAR" />
    <result column="PTO_MONTH" property="ptoMonth" jdbcType="VARCHAR" />
    <result column="PTO_OPEN_DAY" property="ptoOpenDay" jdbcType="VARCHAR" />
    <result column="PTO_ACTION" property="ptoAction" jdbcType="VARCHAR" />
    <result column="PTO_CHECK_STATE" property="ptoCheckState" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List">
  	pto_id, pto_ctime, pto_utime, pto_cuser, pto_uuser, pto_product_type, pto_year, pto_month, pto_open_day, pto_action, pto_check_state
  </sql>
  <insert id="insert" parameterType="com.sams.custom.model.ProTypeOpenDay" >
    insert into P_PROTYPE_OPEN_DATE (PTO_ID, PTO_CTIME, PTO_UTIME, 
      PTO_CUSER, PTO_UUSER, PTO_PRODUCT_TYPE, 
      PTO_YEAR, PTO_MONTH, PTO_OPEN_DAY, 
      PTO_ACTION, PTO_CHECK_STATE)
    values (#{ptoId,jdbcType=VARCHAR}, #{ptoCtime,jdbcType=TIMESTAMP}, #{ptoUtime,jdbcType=TIMESTAMP}, 
      #{ptoCuser,jdbcType=VARCHAR}, #{ptoUuser,jdbcType=VARCHAR}, #{ptoProductType,jdbcType=VARCHAR}, 
      #{ptoYear,jdbcType=VARCHAR}, #{ptoMonth,jdbcType=VARCHAR}, #{ptoOpenDay,jdbcType=VARCHAR}, 
      #{ptoAction,jdbcType=VARCHAR}, #{ptoCheckState,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.sams.custom.model.ProTypeOpenDay" >
    insert into P_PROTYPE_OPEN_DATE
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="ptoId != null" >
        PTO_ID,
      </if>
      <if test="ptoCtime != null" >
        PTO_CTIME,
      </if>
      <if test="ptoUtime != null" >
        PTO_UTIME,
      </if>
      <if test="ptoCuser != null" >
        PTO_CUSER,
      </if>
      <if test="ptoUuser != null" >
        PTO_UUSER,
      </if>
      <if test="ptoProductType != null" >
        PTO_PRODUCT_TYPE,
      </if>
      <if test="ptoYear != null" >
        PTO_YEAR,
      </if>
      <if test="ptoMonth != null" >
        PTO_MONTH,
      </if>
      <if test="ptoOpenDay != null" >
        PTO_OPEN_DAY,
      </if>
      <if test="ptoAction != null" >
        PTO_ACTION,
      </if>
      <if test="ptoCheckState != null" >
        PTO_CHECK_STATE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="ptoId != null" >
        #{ptoId,jdbcType=VARCHAR},
      </if>
      <if test="ptoCtime != null" >
        #{ptoCtime,jdbcType=TIMESTAMP},
      </if>
      <if test="ptoUtime != null" >
        #{ptoUtime,jdbcType=TIMESTAMP},
      </if>
      <if test="ptoCuser != null" >
        #{ptoCuser,jdbcType=VARCHAR},
      </if>
      <if test="ptoUuser != null" >
        #{ptoUuser,jdbcType=VARCHAR},
      </if>
      <if test="ptoProductType != null" >
        #{ptoProductType,jdbcType=VARCHAR},
      </if>
      <if test="ptoYear != null" >
        #{ptoYear,jdbcType=VARCHAR},
      </if>
      <if test="ptoMonth != null" >
        #{ptoMonth,jdbcType=VARCHAR},
      </if>
      <if test="ptoOpenDay != null" >
        #{ptoOpenDay,jdbcType=VARCHAR},
      </if>
      <if test="ptoAction != null" >
        #{ptoAction,jdbcType=VARCHAR},
      </if>
      <if test="ptoCheckState != null" >
        #{ptoCheckState,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="getProductTypeCombox" parameterType="map" resultType="map">
  	select t.dict_code typeVal, t.dict_name typeName from sys_dict t
 	where t.dict_type = 'fundType'
 	<if test="OPTYPE != null">
 		and t.dict_code in 
 		<foreach collection="OPTYPE" open="(" close=")" item="id" separator=",">
 		#{id}
 		</foreach>
 	</if>
  </select>
  
  <select id="findProductOpenCondition" parameterType="java.util.Map"  resultMap="BaseResultMap">
  	select
        <include refid="Base_Column_List"/>
        FROM p_protype_open_date where 1=1
        <if test=" condition.ptoProductType != null and condition.ptoProductType != ''  ">
                and pto_product_type =  #{condition.ptoProductType} 
        </if>
        <if test=" condition.ptoYear != null and condition.ptoYear != ''  ">
                and pto_year =  #{condition.ptoYear} 
        </if>
        <if test=" condition.ptoMonth != null and condition.ptoMonth != ''  ">
                and pto_Month =  #{condition.ptoMonth} 
        </if>
  </select>
  
  <select id="selectMonList" parameterType="map" resultMap="BaseResultMap">
  	select t1.*
        from p_protype_open_date t1,
        (select pto_month pt_month, max(pto_open_day) pto_open_day
        from p_protype_open_date
        where 1=1
        <if test="YEAR != null" >
            AND  PTO_YEAR=#{YEAR,jdbcType=VARCHAR}
        </if>
        <if test="PRODUCTTYPE != null" >
            AND  PTO_PRODUCT_TYPE=#{PRODUCTTYPE,jdbcType=VARCHAR}
        </if>
        group by pto_month) t2
        where t1.pto_open_day = t2.pto_open_day
        and t1.pto_month = t2.pt_month
        <if test="YEAR != null" >
            AND  T1.PTO_YEAR=#{YEAR,jdbcType=VARCHAR}
        </if>
        <if test="PRODUCTTYPE != null" >
            AND  T1.PTO_PRODUCT_TYPE=#{PRODUCTTYPE,jdbcType=VARCHAR}
        </if>
  </select>
  
<insert id="insertByBatch">
   insert 
  	<foreach collection="TYPEOPENDAY" index="index" item="item" open="All" close="SELECT 1 FROM DUAL">
 	into P_PROTYPE_OPEN_DATE (PTO_CTIME,
      PTO_CUSER, PTO_PRODUCT_TYPE, 
      PTO_YEAR, PTO_MONTH, PTO_OPEN_DAY, 
      PTO_ACTION, PTO_CHECK_STATE)
    values (
      #{item.ptoCtime,jdbcType=TIMESTAMP},
      #{item.ptoCuser,jdbcType=VARCHAR}, 
      #{item.ptoProductType,jdbcType=VARCHAR}, 
      #{item.ptoYear,jdbcType=VARCHAR}, 
      #{item.ptoMonth,jdbcType=VARCHAR}, 
      #{item.ptoOpenDay,jdbcType=VARCHAR}, 
      #{item.ptoAction,jdbcType=VARCHAR},
      #{item.ptoCheckState,jdbcType=VARCHAR})
      </foreach>
</insert>
<delete id= "deleteProductTypeOpenDay" parameterType="map" >
	delete from p_protype_open_date t where 1 = 1 
	<if test="productType != null and productType != ''">
		and t.pto_product_type = #{productType,jdbcType = VARCHAR} 
	</if>
	<if test="month != null and month != ''">
		and t.pto_month = #{month,jdbcType = VARCHAR}
	</if>
	<if test="MONTHS != null">
		and t.pto_month in 
		<foreach collection="MONTHS" item = "month" open="(" close=")" separator=",">
			#{month}
		</foreach>
	</if>
</delete>

<update id="checkByBatch" parameterType="map">
	update p_protype_open_date t
   set t.pto_utime = sysdate, 
   t.pto_check_state = '01', 
   t.pto_uuser = #{USERNAME,jdbcType = VARCHAR}
 	where t.pto_product_type = #{PRODUCTTYPE,jdbcType = VARCHAR}
 	and t.pto_year = #{YEAR,jdbcType = VARCHAR}
 	<if test="MONTHS != null">
 		and t.pto_month in
 		<foreach collection="MONTHS" item="month" open="(" close=")" separator=",">
 			#{month}
 		</foreach>
 	</if>
</update>
</mapper>