--丰利F类对账数据取值
select 'TTTNETB3' channelcode, --CHANNELCODE
       '20200526' transdate, --TRANSDATE
       t5.f_remainshares availablevol,
       t5.f_remainshares totalvolofdistributorinta,
       '20200526' transactioncfmdate, --TRANSDATE
       t6.dci_fund_code fundcode,
       t6.dci_trans_action_account transactionaccountid,
       t6.dci_distributor_code distributorcode,
       t6.dci_ta_account_id taaccountid,
       '' totalfrozenvol,
       t6.dci_branch_code branchcode,
       to_char(sysdate, 'yyyyMMddHHmmss') || seq_taserialno_new.nextval taserialno,
       '' totalbackendload,
       '0' shareclass,
       '0' detailflag,
       '' accountstatus,
       '' shareregisterdate,
       t5.f_income undistributemonetaryincome,
       '0' undistributemonetaryincomeflag,
       '' guaranteedamount,
       '' sourcetype,
       '' defdividendmethod
  from (select sum(t3.f_remainshares) f_remainshares,
               t4.dci_ta_account_id taaccountid,
               t4.dci_trans_action_account transactionaccountid,
               t4.dci_fund_code fundcode,
               sum(t3.f_income) f_income
          from (select *
                  from (select t.l_contractserialno,
                               t.c_fundcode,
                               t.f_remainshares,
                               t.f_income
                          from tj_contractfund t, ta_ttrustcontractdetails t2
                         where t.l_contractserialno = t2.l_serialno
                           and t2.c_trustagencyno in
                               (select t.c_agencyno
                                  from ta_ttrustagencyinfo t
                                 where t.c_agencyno = 'TTTNETB3' -- CHANNELCODE
                                    or t.c_parentcode = 'TTTNETB3') --CHANNELCODE
                        ) TT
                 where exists
                 (select 1
                          from p_product_info p, p_channel_product c
                         where p.pi_channel_product_code =
                               c.cp_channel_product_code
                           and p.pi_channel_code = c.cp_channel_code
                           and c.cp_channel_code = 'TTTNETB3' --CHANNELCODE
                           and c.cp_valid_flag = '01'
                           and c.cp_check_state = '01'
                           and p.pi_valid_flag not in ('00', '99')
                           and p.pi_check_state = '01'
                           and p.pi_product_type = '0'
                           and to_date(p.pi_pro_setup_date, 'yyyyMMdd') <=
                               to_date('20200526', 'yyyyMMdd') --TRANSDATE
                           and c.cp_ta_product_code = tt.c_fundcode)) t3,
               d_contract_info t4
         where t4.dci_valid_flag = '01'
           and t3.l_contractserialno = t4.dci_in_contract
           and t4.dci_channel_code = 'TTTNETB3' --CHANNELCODE
         group by t4.dci_channel_code,
                  t4.dci_ta_account_id,
                  t4.dci_trans_action_account,
                  t4.dci_fund_code) t5,
       (select distinct i.dci_ta_account_id,
                        i.dci_trans_action_account,
                        i.dci_fund_code,
                        i.dci_distributor_code,
                        i.dci_branch_code,
                        i.dci_product_code
          from (select *
                  from d_contract_info o
                 where exists
                 (select 1
                          from p_product_info p, p_channel_product c
                         where p.pi_channel_product_code =
                               c.cp_channel_product_code
                           and p.pi_channel_code = c.cp_channel_code
                           and c.cp_channel_code = 'TTTNETB3' --CHANNELCODE
                           and c.cp_valid_flag = '01'
                           and c.cp_check_state = '01'
                           and p.pi_valid_flag not in ('00', '99')
                           and p.pi_check_state = '01'
                           and p.pi_product_type = '0' --FUNDTYPE
                           and to_date(p.pi_pro_setup_date, 'yyyyMMdd') <=
                               to_date('20200526', 'yyyyMMdd') --TRANSDATE
                           and c.cp_ta_product_code = o.dci_product_code
                           and p.pi_channel_product_code = o.dci_fund_code)
                   and o.dci_valid_flag = '01') i
         where i.dci_channel_code = 'TTTNETB3' --CHANNELCODE
         group by i.dci_channel_code,
                  i.dci_ta_account_id,
                  i.dci_trans_action_account,
                  i.dci_fund_code,
                  i.dci_distributor_code,
                  i.dci_branch_code,
                  i.dci_product_code) t6
 where t5.taaccountid = t6.dci_ta_account_id
   and t5.transactionaccountid = t6.dci_trans_action_account
   and t5.fundcode = t6.dci_fund_code
